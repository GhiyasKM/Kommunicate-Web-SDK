function MckCallingService(e,t,n,o,r,s,i,a,c,l){var u=this,d=$applozic("#mck-vid-icon");$applozic("#mck-sidebox");u.callStartTime=s,u.mckMessageService=i,u.identity=e,u.token=t,u.callId=n,u.isCallHost=r,u.toUserImage=a,u.toUserDisplayName=o,u.isAudioCall=c,u.disconectedByHost,u.rejectedByReceiver,u.twilioService,console.log("is AudioCall:"+c),u.ringTone=l;var p=$applozic("#mck-msg-to"),f=$applozic(".applozic-vid-container"),h=($applozic("#mck-sidebox"),$applozic("#mck-video-call-indicator")),m=$applozic("#mck-unmute-icon"),g=$applozic("#mck-mute-icon"),v=$applozic("#mck-microfone-mute-btn");$applozic("#mck-microfone-mute-btn").off("click").on("click",function(){p.val();var e=u.twilioService.activeRoom;if(e){var t=e.localParticipant.media;t.isMuted?(m.addClass("vis").removeClass("n-vis"),g.addClass("n-vis").removeClass("vis"),v.addClass("mck-unmuted").removeClass("mck-muted"),t.unmute()):(g.addClass("vis").removeClass("n-vis"),m.addClass("n-vis").removeClass("vis"),v.addClass("mck-muted").removeClass("mck-unmuted"),t.mute())}}),$applozic("#mck-vid-disconnect").off("click").on("click",function(){var e=p.val();if(r)if(u.disconectedByHost=!0,u.twilioService.callReceivedAt){var t=u.twilioService.callReceivedAt.getTime(),o=(new Date).getTime()-t;alMessageService.sendVideoCallEndMessage(n,"CALL_END",102,!1,o,e,function(e){i.sendMessage(e)})}else u.ringTone.stop(),alMessageService.sendVideoCallMessage(n,"CALL_MISSED",103,!1,e,function(e){i.sendMessage(e)});u.twilioService.leaveRoomIfJoined(),u.removeTracks(["#mck-vid-media > video","#mck-vid-media > audio","#local-media > video","#local-media > audio"]),f.addClass("n-vis").removeClass("vis"),h.addClass("n-vis").removeClass("vis")}),u.startVideoCall=function(){navigator.webkitGetUserMedia||navigator.mozGetUserMedia||alert("WebRTC is not available in your browser. can not start video call"),u.token||(alert("missing token.. can not make video call"),f.removeClass("vis").addClass("n-vis")),u.twilioService=new TwilioService(u.identity,u.token,u.callId,u.ringTone,u.isAudioCall,u.mckMessageService,u.isCallHost);u.twilioService.InitializeVideoClient();r&&(d.html(a+"<span> Calling "+o+"</span>"),d.removeClass("n-vis").addClass("vis"),setTimeout(function(){u.twilioService.isCallReceived||u.disconectedByHost||u.rejectedByReceiver||(console.log("call is not answered...."),u.ringTone.stop(),alMessageService.sendVideoCallMessage(n,"CALL_MISSED",103,c,toUser,function(e){i.sendMessage(e)}),alert(o+" not Available...."),u.twilioService.leaveRoomIfJoined(),u.removeTracks(["#mck-vid-media > video","#mck-vid-media > audio","#local-media > video","#local-media > audio"]),f.addClass("n-vis").removeClass("vis"))},7e4)),window.addEventListener("beforeunload",u.twilioService.leaveRoomIfJoined),u.twilioService.attachUserMedia(r,c),u.twilioService.joinCall(c),f.removeClass("n-vis").addClass("vis"),m.addClass("vis").removeClass("n-vis"),g.addClass("n-vis").removeClass("vis"),v.addClass("mck-unmuted").removeClass("mck-muted")},u.removeTracks=function(e){$applozic.each(e,function(e,t){$applozic(t).remove()})}}function TwilioService(e,t,n,o,r,s,i){var a=this;a.identity=e,a.token=t,a.callId=n,a.videoClient,a.activeRoom,a.previewMedia,a.ringTone=o,a.isCallReceived,a.callReceivedAt,a.isAudioCall=r,a.mckMessageService=s,a.isCallHost=i;var c=$applozic("#mck-msg-to"),l=$applozic("#mck-vid-icon"),u=($applozic("#local-media > video"),$applozic("#mck-vid-media > video"),$applozic("#local-media")),d=$applozic(".applozic-vid-container"),p=($applozic("#mck-sidebox"),$applozic("#mck-video-call-indicator"));a.InitializeVideoClient=function(){a.videoClient=new Twilio.Video.Client(a.token)},a.joinCall=function(e){a.videoClient&&a.videoClient.connect({to:a.callId}).then(a.roomJoined,function(e){console.log("Could not connect to Twilio: "+e.message)})},a.attachUserMedia=function(e,t){a.previewMedia||(a.previewMedia=new Twilio.Video.LocalMedia,Twilio.Video.getUserMedia().then(function(t){a.previewMedia.addStream(t),e?(a.previewMedia.attach("#mck-vid-media"),a.ringTone.play()):(a.previewMedia.attach("#local-media"),u.removeClass("n-vis").addClass("vis"))},function(e){console.error("Unable to access local media",e),console.log("Unable to access Camera and Microphone")}))},a.roomJoined=function(e){console.log("room detail : "+e),a.activeRoom=e,a.previewMedia||e.localParticipant.media.attach("#mck-vid-media"),e.participants.forEach(function(e){console.log("Already in Room: '"+e.identity+"'"),e.media.attach("#mck-vid-media")}),e.on("participantConnected",function(t){console.log("participent- "+t.identity+"connected to the room- "+e),a.isCallReceived=!0,a.callReceivedAt=new Date,console.log("callReceivedAt : "+a.callReceivedAt),a.ringTone.stop(),l.addClass("n-vis"),$applozic("#mck-vid-media > video").remove(),$applozic("#mck-vid-media > audio").remove(),e.localParticipant.media.attach("#local-media"),u.removeClass("n-vis").addClass("vis"),t.media.attach("#mck-vid-media")}),e.on("participantDisconnected",function(e){if(console.log("Participant '"+e.identity+"' left the room"),a.isCallHost){var t=c.val(),o=a.callReceivedAt.getTime(),r=(new Date).getTime()-o;alMessageService.sendVideoCallEndMessage(n,"CALL_END",103,!1,r,t,function(e){s.sendMessage(e)})}e.media.detach(),a.leaveRoomIfJoined(),d.addClass("n-vis").removeClass("vis"),p.addClass("n-vis").removeClass("vis")}),e.on("disconnected",function(){console.log("Left"),e.localParticipant.media.detach(),e.participants.forEach(function(e){e.media.detach()}),a.activeRoom=null})},a.leaveRoomIfJoined=function(){a.activeRoom&&a.activeRoom.disconnect(),a.previewMedia&&a.previewMedia.stop()}}!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).SockJS=e()}(function(){return function e(t,n,o){function r(i,a){if(!n[i]){if(!t[i]){var c="function"==typeof require&&require;if(!a&&c)return c(i,!0);if(s)return s(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[i]={exports:{}};t[i][0].call(u.exports,function(e){return r(t[i][1][e]||e)},u,u.exports,e,t,n,o)}return n[i].exports}for(var s="function"==typeof require&&require,i=0;i<o.length;i++)r(o[i]);return r}({1:[function(e,t,n){(function(n){"use strict";var o=e("./transport-list");t.exports=e("./main")(o),"_sockjs_onload"in n&&setTimeout(n._sockjs_onload,1)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./main":14,"./transport-list":16}],2:[function(e,t,n){"use strict";var o=e("inherits"),r=e("./event");function s(){r.call(this),this.initEvent("close",!1,!1),this.wasClean=!1,this.code=0,this.reason=""}o(s,r),t.exports=s},{"./event":4,inherits:54}],3:[function(e,t,n){"use strict";var o=e("inherits"),r=e("./eventtarget");function s(){r.call(this)}o(s,r),s.prototype.removeAllListeners=function(e){e?delete this._listeners[e]:this._listeners={}},s.prototype.once=function(e,t){var n=this,o=!1;this.on(e,function r(){n.removeListener(e,r),o||(o=!0,t.apply(this,arguments))})},s.prototype.emit=function(){var e=arguments[0],t=this._listeners[e];if(t){for(var n=arguments.length,o=new Array(n-1),r=1;r<n;r++)o[r-1]=arguments[r];for(var s=0;s<t.length;s++)t[s].apply(this,o)}},s.prototype.on=s.prototype.addListener=r.prototype.addEventListener,s.prototype.removeListener=r.prototype.removeEventListener,t.exports.EventEmitter=s},{"./eventtarget":5,inherits:54}],4:[function(e,t,n){"use strict";function o(e){this.type=e}o.prototype.initEvent=function(e,t,n){return this.type=e,this.bubbles=t,this.cancelable=n,this.timeStamp=+new Date,this},o.prototype.stopPropagation=function(){},o.prototype.preventDefault=function(){},o.CAPTURING_PHASE=1,o.AT_TARGET=2,o.BUBBLING_PHASE=3,t.exports=o},{}],5:[function(e,t,n){"use strict";function o(){this._listeners={}}o.prototype.addEventListener=function(e,t){e in this._listeners||(this._listeners[e]=[]);var n=this._listeners[e];-1===n.indexOf(t)&&(n=n.concat([t])),this._listeners[e]=n},o.prototype.removeEventListener=function(e,t){var n=this._listeners[e];if(n){var o=n.indexOf(t);-1===o||(1<n.length?this._listeners[e]=n.slice(0,o).concat(n.slice(o+1)):delete this._listeners[e])}},o.prototype.dispatchEvent=function(){var e=arguments[0],t=e.type,n=1===arguments.length?[e]:Array.apply(null,arguments);if(this["on"+t]&&this["on"+t].apply(this,n),t in this._listeners)for(var o=this._listeners[t],r=0;r<o.length;r++)o[r].apply(this,n)},t.exports=o},{}],6:[function(e,t,n){"use strict";var o=e("inherits"),r=e("./event");function s(e){r.call(this),this.initEvent("message",!1,!1),this.data=e}o(s,r),t.exports=s},{"./event":4,inherits:54}],7:[function(e,t,n){"use strict";var o=e("json3"),r=e("./utils/iframe");function s(e){(this._transport=e).on("message",this._transportMessage.bind(this)),e.on("close",this._transportClose.bind(this))}s.prototype._transportClose=function(e,t){r.postMessage("c",o.stringify([e,t]))},s.prototype._transportMessage=function(e){r.postMessage("t",e)},s.prototype._send=function(e){this._transport.send(e)},s.prototype._close=function(){this._transport.close(),this._transport.removeAllListeners()},t.exports=s},{"./utils/iframe":47,json3:55}],8:[function(e,t,n){"use strict";var o=e("./utils/url"),r=e("./utils/event"),s=e("json3"),i=e("./facade"),a=e("./info-iframe-receiver"),c=e("./utils/iframe"),l=e("./location");t.exports=function(e,t){var n,u={};t.forEach(function(e){e.facadeTransport&&(u[e.facadeTransport.transportName]=e.facadeTransport)}),u[a.transportName]=a,e.bootstrap_iframe=function(){var t;c.currentWindowId=l.hash.slice(1),r.attachEvent("message",function(r){if(r.source===parent&&(void 0===n&&(n=r.origin),r.origin===n)){var a;try{a=s.parse(r.data)}catch(d){return void r.data}if(a.windowId===c.currentWindowId)switch(a.type){case"s":var d;try{d=s.parse(a.data)}catch(d){a.data;break}var p=d[0],f=d[1],h=d[2],m=d[3];if(p!==e.version)throw new Error('Incompatible SockJS! Main site uses: "'+p+'", the iframe: "'+e.version+'".');if(!o.isOriginEqual(h,l.href)||!o.isOriginEqual(m,l.href))throw new Error("Can't connect to different domain from within an iframe. ("+l.href+", "+h+", "+m+")");t=new i(new u[f](h,m));break;case"m":t._send(a.data);break;case"c":t&&t._close(),t=null}}}),c.postMessage("s")}}},{"./facade":7,"./info-iframe-receiver":10,"./location":13,"./utils/event":46,"./utils/iframe":47,"./utils/url":52,debug:void 0,json3:55}],9:[function(e,t,n){"use strict";var o=e("events").EventEmitter,r=e("inherits"),s=e("json3"),i=e("./utils/object"),a=function(){};function c(e,t){o.call(this);var n=this,r=+new Date;this.xo=new t("GET",e),this.xo.once("finish",function(e,t){var o,c;if(200===e){if(c=+new Date-r,t)try{o=s.parse(t)}catch(e){a("bad json",t)}i.isObject(o)||(o={})}n.emit("finish",o,c),n.removeAllListeners()})}r(c,o),c.prototype.close=function(){this.removeAllListeners(),this.xo.close()},t.exports=c},{"./utils/object":49,debug:void 0,events:3,inherits:54,json3:55}],10:[function(e,t,n){"use strict";var o=e("inherits"),r=e("events").EventEmitter,s=e("json3"),i=e("./transport/sender/xhr-local"),a=e("./info-ajax");function c(e){var t=this;r.call(this),this.ir=new a(e,i),this.ir.once("finish",function(e,n){t.ir=null,t.emit("message",s.stringify([e,n]))})}o(c,r),c.transportName="iframe-info-receiver",c.prototype.close=function(){this.ir&&(this.ir.close(),this.ir=null),this.removeAllListeners()},t.exports=c},{"./info-ajax":9,"./transport/sender/xhr-local":37,events:3,inherits:54,json3:55}],11:[function(e,t,n){(function(n){"use strict";var o=e("events").EventEmitter,r=e("inherits"),s=e("json3"),i=e("./utils/event"),a=e("./transport/iframe"),c=e("./info-iframe-receiver"),l=function(){};function u(e,t){var r=this;function u(){var n=r.ifr=new a(c.transportName,t,e);n.once("message",function(e){if(e){var t;try{t=s.parse(e)}catch(t){return l("bad json",e),r.emit("finish"),void r.close()}var n=t[0],o=t[1];r.emit("finish",n,o)}r.close()}),n.once("close",function(){r.emit("finish"),r.close()})}o.call(this),n.document.body?u():i.attachEvent("load",u)}r(u,o),u.enabled=function(){return a.enabled()},u.prototype.close=function(){this.ifr&&this.ifr.close(),this.removeAllListeners(),this.ifr=null},t.exports=u}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./info-iframe-receiver":10,"./transport/iframe":22,"./utils/event":46,debug:void 0,events:3,inherits:54,json3:55}],12:[function(e,t,n){"use strict";var o=e("events").EventEmitter,r=e("inherits"),s=e("./utils/url"),i=e("./transport/sender/xdr"),a=e("./transport/sender/xhr-cors"),c=e("./transport/sender/xhr-local"),l=e("./transport/sender/xhr-fake"),u=e("./info-iframe"),d=e("./info-ajax"),p=function(){};function f(e,t){p(e);var n=this;o.call(this),setTimeout(function(){n.doXhr(e,t)},0)}r(f,o),f._getReceiver=function(e,t,n){return n.sameOrigin?new d(t,c):a.enabled?new d(t,a):i.enabled&&n.sameScheme?new d(t,i):u.enabled()?new u(e,t):new d(t,l)},f.prototype.doXhr=function(e,t){var n=this,o=s.addPath(e,"/info");p("doXhr",o),this.xo=f._getReceiver(e,o,t),this.timeoutRef=setTimeout(function(){p("timeout"),n._cleanup(!1),n.emit("finish")},f.timeout),this.xo.once("finish",function(e,t){p("finish",e,t),n._cleanup(!0),n.emit("finish",e,t)})},f.prototype._cleanup=function(e){p("_cleanup"),clearTimeout(this.timeoutRef),this.timeoutRef=null,!e&&this.xo&&this.xo.close(),this.xo=null},f.prototype.close=function(){p("close"),this.removeAllListeners(),this._cleanup(!1)},f.timeout=8e3,t.exports=f},{"./info-ajax":9,"./info-iframe":11,"./transport/sender/xdr":34,"./transport/sender/xhr-cors":35,"./transport/sender/xhr-fake":36,"./transport/sender/xhr-local":37,"./utils/url":52,debug:void 0,events:3,inherits:54}],13:[function(e,t,n){(function(e){"use strict";t.exports=e.location||{origin:"http://localhost:80",protocol:"http:",host:"localhost",port:80,href:"http://localhost/",hash:""}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],14:[function(e,t,n){(function(n){"use strict";e("./shims");var o,r=e("url-parse"),s=e("inherits"),i=e("json3"),a=e("./utils/random"),c=e("./utils/escape"),l=e("./utils/url"),u=e("./utils/event"),d=e("./utils/transport"),p=e("./utils/object"),f=e("./utils/browser"),h=e("./utils/log"),m=e("./event/event"),g=e("./event/eventtarget"),v=e("./location"),y=e("./event/close"),b=e("./event/trans-message"),w=e("./info-receiver"),S=function(){};function C(e,t,n){if(!(this instanceof C))return new C(e,t,n);if(arguments.length<1)throw new TypeError("Failed to construct 'SockJS: 1 argument required, but only 0 present");g.call(this),this.readyState=C.CONNECTING,this.extensions="",this.protocol="",(n=n||{}).protocols_whitelist&&h.warn("'protocols_whitelist' is DEPRECATED. Use 'transports' instead."),this._transportsWhitelist=n.transports,this._transportOptions=n.transportOptions||{},this._timeout=n.timeout||0;var o=n.sessionId||8;if("function"==typeof o)this._generateSessionId=o;else{if("number"!=typeof o)throw new TypeError("If sessionId is used in the options, it needs to be a number or a function.");this._generateSessionId=function(){return a.string(o)}}this._server=n.server||a.numberString(1e3);var s=new r(e);if(!s.host||!s.protocol)throw new SyntaxError("The URL '"+e+"' is invalid");if(s.hash)throw new SyntaxError("The URL must not contain a fragment");if("http:"!==s.protocol&&"https:"!==s.protocol)throw new SyntaxError("The URL's scheme must be either 'http:' or 'https:'. '"+s.protocol+"' is not allowed.");var i="https:"===s.protocol;if("https:"===v.protocol&&!i)throw new Error("SecurityError: An insecure SockJS connection may not be initiated from a page loaded over HTTPS");t?Array.isArray(t)||(t=[t]):t=[];var c=t.sort();c.forEach(function(e,t){if(!e)throw new SyntaxError("The protocols entry '"+e+"' is invalid.");if(t<c.length-1&&e===c[t+1])throw new SyntaxError("The protocols entry '"+e+"' is duplicated.")});var u=l.getOrigin(v.href);this._origin=u?u.toLowerCase():null,s.set("pathname",s.pathname.replace(/\/+$/,"")),this.url=s.href,S("using url",this.url),this._urlInfo={nullOrigin:!f.hasDomain(),sameOrigin:l.isOriginEqual(this.url,v.href),sameScheme:l.isSchemeEqual(this.url,v.href)},this._ir=new w(this.url,this._urlInfo),this._ir.once("finish",this._receiveInfo.bind(this))}function A(e){return 1e3===e||3e3<=e&&e<=4999}s(C,g),C.prototype.close=function(e,t){if(e&&!A(e))throw new Error("InvalidAccessError: Invalid code");if(t&&123<t.length)throw new SyntaxError("reason argument has an invalid length");this.readyState!==C.CLOSING&&this.readyState!==C.CLOSED&&this._close(e||1e3,t||"Normal closure",!0)},C.prototype.send=function(e){if("string"!=typeof e&&(e=""+e),this.readyState===C.CONNECTING)throw new Error("InvalidStateError: The connection has not been established yet");this.readyState===C.OPEN&&this._transport.send(c.quote(e))},C.version=e("./version"),C.CONNECTING=0,C.OPEN=1,C.CLOSING=2,C.CLOSED=3,C.prototype._receiveInfo=function(e,t){if(S("_receiveInfo",t),this._ir=null,e){this._rto=this.countRTO(t),this._transUrl=e.base_url?e.base_url:this.url,e=p.extend(e,this._urlInfo),S("info",e);var n=o.filterToEnabled(this._transportsWhitelist,e);this._transports=n.main,S(this._transports.length+" enabled transports"),this._connect()}else this._close(1002,"Cannot connect to server")},C.prototype._connect=function(){for(var e=this._transports.shift();e;e=this._transports.shift()){if(S("attempt",e.transportName),e.needBody&&(!n.document.body||void 0!==n.document.readyState&&"complete"!==n.document.readyState&&"interactive"!==n.document.readyState))return S("waiting for body"),this._transports.unshift(e),void u.attachEvent("load",this._connect.bind(this));var t=Math.max(this._timeout,this._rto*e.roundTrips||5e3);this._transportTimeoutId=setTimeout(this._transportTimeout.bind(this),t),S("using timeout",t);var o=l.addPath(this._transUrl,"/"+this._server+"/"+this._generateSessionId()),r=this._transportOptions[e.transportName];S("transport url",o);var s=new e(o,this._transUrl,r);return s.on("message",this._transportMessage.bind(this)),s.once("close",this._transportClose.bind(this)),s.transportName=e.transportName,void(this._transport=s)}this._close(2e3,"All transports failed",!1)},C.prototype._transportTimeout=function(){S("_transportTimeout"),this.readyState===C.CONNECTING&&(this._transport&&this._transport.close(),this._transportClose(2007,"Transport timed out"))},C.prototype._transportMessage=function(e){S("_transportMessage",e);var t,n=this,o=e.slice(0,1),r=e.slice(1);switch(o){case"o":return void this._open();case"h":return this.dispatchEvent(new m("heartbeat")),void S("heartbeat",this.transport)}if(r)try{t=i.parse(r)}catch(e){S("bad json",r)}if(void 0!==t)switch(o){case"a":Array.isArray(t)&&t.forEach(function(e){S("message",n.transport,e),n.dispatchEvent(new b(e))});break;case"m":S("message",this.transport,t),this.dispatchEvent(new b(t));break;case"c":Array.isArray(t)&&2===t.length&&this._close(t[0],t[1],!0)}else S("empty payload",r)},C.prototype._transportClose=function(e,t){S("_transportClose",this.transport,e,t),this._transport&&(this._transport.removeAllListeners(),this._transport=null,this.transport=null),A(e)||2e3===e||this.readyState!==C.CONNECTING?this._close(e,t):this._connect()},C.prototype._open=function(){S("_open",this._transport&&this._transport.transportName,this.readyState),this.readyState===C.CONNECTING?(this._transportTimeoutId&&(clearTimeout(this._transportTimeoutId),this._transportTimeoutId=null),this.readyState=C.OPEN,this.transport=this._transport.transportName,this.dispatchEvent(new m("open")),S("connected",this.transport)):this._close(1006,"Server lost session")},C.prototype._close=function(e,t,n){S("_close",this.transport,e,t,n,this.readyState);var o=!1;if(this._ir&&(o=!0,this._ir.close(),this._ir=null),this._transport&&(this._transport.close(),this._transport=null,this.transport=null),this.readyState===C.CLOSED)throw new Error("InvalidStateError: SockJS has already been closed");this.readyState=C.CLOSING,setTimeout(function(){this.readyState=C.CLOSED,o&&this.dispatchEvent(new m("error"));var r=new y("close");r.wasClean=n||!1,r.code=e||1e3,r.reason=t,this.dispatchEvent(r),this.onmessage=this.onclose=this.onerror=null,S("disconnected")}.bind(this),0)},C.prototype.countRTO=function(e){return 100<e?4*e:300+e},t.exports=function(t){return o=d(t),e("./iframe-bootstrap")(C,t),C}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./event/close":2,"./event/event":4,"./event/eventtarget":5,"./event/trans-message":6,"./iframe-bootstrap":8,"./info-receiver":12,"./location":13,"./shims":15,"./utils/browser":44,"./utils/escape":45,"./utils/event":46,"./utils/log":48,"./utils/object":49,"./utils/random":50,"./utils/transport":51,"./utils/url":52,"./version":53,debug:void 0,inherits:54,json3:55,"url-parse":58}],15:[function(e,t,n){"use strict";function o(e){return"[object Function]"===a.toString.call(e)}function r(e){return"[object String]"===d.call(e)}var s,i=Array.prototype,a=Object.prototype,c=Function.prototype,l=String.prototype,u=i.slice,d=a.toString,p=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}}();function f(e,t,n){for(var o in t)a.hasOwnProperty.call(t,o)&&s(e,o,t[o],n)}function h(e){if(null==e)throw new TypeError("can't convert "+e+" to object");return Object(e)}function m(){}s=p?function(e,t,n,o){!o&&t in e||Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:n})}:function(e,t,n,o){!o&&t in e||(e[t]=n)},f(c,{bind:function(e){var t=this;if(!o(t))throw new TypeError("Function.prototype.bind called on incompatible "+t);for(var n=u.call(arguments,1),r=Math.max(0,t.length-n.length),s=[],i=0;i<r;i++)s.push("$"+i);var a=Function("binder","return function ("+s.join(",")+"){ return binder.apply(this, arguments); }")(function(){if(this instanceof a){var o=t.apply(this,n.concat(u.call(arguments)));return Object(o)===o?o:this}return t.apply(e,n.concat(u.call(arguments)))});return t.prototype&&(m.prototype=t.prototype,a.prototype=new m,m.prototype=null),a}}),f(Array,{isArray:function(e){return"[object Array]"===d.call(e)}});var g,v,y,b=Object("a"),w="a"!==b[0]||!(0 in b);f(i,{forEach:function(e,t){var n=h(this),s=w&&r(this)?this.split(""):n,i=t,a=-1,c=s.length>>>0;if(!o(e))throw new TypeError;for(;++a<c;)a in s&&e.call(i,s[a],a,n)}},(g=i.forEach,y=v=!0,g&&(g.call("foo",function(e,t,n){"object"!=typeof n&&(v=!1)}),g.call([1],function(){y="string"==typeof this},"x")),!(g&&v&&y)));var S=Array.prototype.indexOf&&-1!==[0,1].indexOf(1,2);f(i,{indexOf:function(e,t){var n=w&&r(this)?this.split(""):h(this),o=n.length>>>0;if(!o)return-1;var s=0;for(1<arguments.length&&(s=function(e){var t=+e;return t!=t?t=0:0!==t&&t!==1/0&&t!==-1/0&&(t=(0<t||-1)*Math.floor(Math.abs(t))),t}(t)),s=0<=s?s:Math.max(0,o+s);s<o;s++)if(s in n&&n[s]===e)return s;return-1}},S);var C,A=l.split;2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||"t"==="tesst".split(/(s)*/)[1]||4!=="test".split(/(?:)/,-1).length||"".split(/.?/).length||1<".".split(/()()/).length?(C=void 0===/()??/.exec("")[1],l.split=function(e,t){var n=this;if(void 0===e&&0===t)return[];if("[object RegExp]"!==d.call(e))return A.call(this,e,t);var o,r,s,a,c=[],l=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.extended?"x":"")+(e.sticky?"y":""),u=0;for(e=new RegExp(e.source,l+"g"),n+="",C||(o=new RegExp("^"+e.source+"$(?!\\s)",l)),t=void 0===t?-1>>>0:t>>>0;(r=e.exec(n))&&!(u<(s=r.index+r[0].length)&&(c.push(n.slice(u,r.index)),!C&&1<r.length&&r[0].replace(o,function(){for(var e=1;e<arguments.length-2;e++)void 0===arguments[e]&&(r[e]=void 0)}),1<r.length&&r.index<n.length&&i.push.apply(c,r.slice(1)),a=r[0].length,u=s,c.length>=t));)e.lastIndex===r.index&&e.lastIndex++;return u===n.length?!a&&e.test("")||c.push(""):c.push(n.slice(u)),c.length>t?c.slice(0,t):c}):"0".split(void 0,0).length&&(l.split=function(e,t){return void 0===e&&0===t?[]:A.call(this,e,t)});var I=l.substr;f(l,{substr:function(e,t){return I.call(this,e<0&&(e=this.length+e)<0?0:e,t)}},"".substr&&"b"!=="0b".substr(-1))},{}],16:[function(e,t,n){"use strict";t.exports=[e("./transport/websocket"),e("./transport/xhr-streaming"),e("./transport/xdr-streaming"),e("./transport/eventsource"),e("./transport/lib/iframe-wrap")(e("./transport/eventsource")),e("./transport/htmlfile"),e("./transport/lib/iframe-wrap")(e("./transport/htmlfile")),e("./transport/xhr-polling"),e("./transport/xdr-polling"),e("./transport/lib/iframe-wrap")(e("./transport/xhr-polling")),e("./transport/jsonp-polling")]},{"./transport/eventsource":20,"./transport/htmlfile":21,"./transport/jsonp-polling":23,"./transport/lib/iframe-wrap":26,"./transport/websocket":38,"./transport/xdr-polling":39,"./transport/xdr-streaming":40,"./transport/xhr-polling":41,"./transport/xhr-streaming":42}],17:[function(e,t,n){(function(n){"use strict";var o=e("events").EventEmitter,r=e("inherits"),s=e("../../utils/event"),i=e("../../utils/url"),a=n.XMLHttpRequest,c=function(){};function l(e,t,n,r){c(e,t);var s=this;o.call(this),setTimeout(function(){s._start(e,t,n,r)},0)}r(l,o),l.prototype._start=function(e,t,n,o){var r=this;try{this.xhr=new a}catch(e){}if(!this.xhr)return c("no xhr"),this.emit("finish",0,"no xhr support"),void this._cleanup();t=i.addQuery(t,"t="+ +new Date),this.unloadRef=s.unloadAdd(function(){c("unload cleanup"),r._cleanup(!0)});try{this.xhr.open(e,t,!0),this.timeout&&"timeout"in this.xhr&&(this.xhr.timeout=this.timeout,this.xhr.ontimeout=function(){c("xhr timeout"),r.emit("finish",0,""),r._cleanup(!1)})}catch(e){return c("exception",e),this.emit("finish",0,""),void this._cleanup(!1)}if(o&&o.noCredentials||!l.supportsCORS||(c("withCredentials"),this.xhr.withCredentials=!0),o&&o.headers)for(var u in o.headers)this.xhr.setRequestHeader(u,o.headers[u]);this.xhr.onreadystatechange=function(){if(r.xhr){var e,t,n=r.xhr;switch(c("readyState",n.readyState),n.readyState){case 3:try{t=n.status,e=n.responseText}catch(e){}c("status",t),1223===t&&(t=204),200===t&&e&&0<e.length&&(c("chunk"),r.emit("chunk",t,e));break;case 4:t=n.status,c("status",t),1223===t&&(t=204),12005!==t&&12029!==t||(t=0),c("finish",t,n.responseText),r.emit("finish",t,n.responseText),r._cleanup(!1)}}};try{r.xhr.send(n)}catch(e){r.emit("finish",0,""),r._cleanup(!1)}},l.prototype._cleanup=function(e){if(c("cleanup"),this.xhr){if(this.removeAllListeners(),s.unloadDel(this.unloadRef),this.xhr.onreadystatechange=function(){},this.xhr.ontimeout&&(this.xhr.ontimeout=null),e)try{this.xhr.abort()}catch(e){}this.unloadRef=this.xhr=null}},l.prototype.close=function(){c("close"),this._cleanup(!0)},l.enabled=!!a;var u=["Active"].concat("Object").join("X");!l.enabled&&u in n&&(c("overriding xmlhttprequest"),l.enabled=!!new(a=function(){try{return new n[u]("Microsoft.XMLHTTP")}catch(e){return null}}));var d=!1;try{d="withCredentials"in new a}catch(n){}l.supportsCORS=d,t.exports=l}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/event":46,"../../utils/url":52,debug:void 0,events:3,inherits:54}],18:[function(e,t,n){(function(e){t.exports=e.EventSource}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],19:[function(e,t,n){(function(e){"use strict";var n=e.WebSocket||e.MozWebSocket;t.exports=n?function(e){return new n(e)}:void 0}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],20:[function(e,t,n){"use strict";var o=e("inherits"),r=e("./lib/ajax-based"),s=e("./receiver/eventsource"),i=e("./sender/xhr-cors"),a=e("eventsource");function c(e){if(!c.enabled())throw new Error("Transport created when disabled");r.call(this,e,"/eventsource",s,i)}o(c,r),c.enabled=function(){return!!a},c.transportName="eventsource",c.roundTrips=2,t.exports=c},{"./lib/ajax-based":24,"./receiver/eventsource":29,"./sender/xhr-cors":35,eventsource:18,inherits:54}],21:[function(e,t,n){"use strict";var o=e("inherits"),r=e("./receiver/htmlfile"),s=e("./sender/xhr-local"),i=e("./lib/ajax-based");function a(e){if(!r.enabled)throw new Error("Transport created when disabled");i.call(this,e,"/htmlfile",r,s)}o(a,i),a.enabled=function(e){return r.enabled&&e.sameOrigin},a.transportName="htmlfile",a.roundTrips=2,t.exports=a},{"./lib/ajax-based":24,"./receiver/htmlfile":30,"./sender/xhr-local":37,inherits:54}],22:[function(e,t,n){"use strict";var o=e("inherits"),r=e("json3"),s=e("events").EventEmitter,i=e("../version"),a=e("../utils/url"),c=e("../utils/iframe"),l=e("../utils/event"),u=e("../utils/random"),d=function(){};function p(e,t,n){if(!p.enabled())throw new Error("Transport created when disabled");s.call(this);var o=this;this.origin=a.getOrigin(n),this.baseUrl=n,this.transUrl=t,this.transport=e,this.windowId=u.string(8);var r=a.addPath(n,"/iframe.html")+"#"+this.windowId;d(e,t,r),this.iframeObj=c.createIframe(r,function(e){d("err callback"),o.emit("close",1006,"Unable to load an iframe ("+e+")"),o.close()}),this.onmessageCallback=this._message.bind(this),l.attachEvent("message",this.onmessageCallback)}o(p,s),p.prototype.close=function(){if(d("close"),this.removeAllListeners(),this.iframeObj){l.detachEvent("message",this.onmessageCallback);try{this.postMessage("c")}catch(e){}this.iframeObj.cleanup(),this.iframeObj=null,this.onmessageCallback=this.iframeObj=null}},p.prototype._message=function(e){if(d("message",e.data),a.isOriginEqual(e.origin,this.origin)){var t;try{t=r.parse(e.data)}catch(n){return void d("bad json",e.data)}if(t.windowId===this.windowId)switch(t.type){case"s":this.iframeObj.loaded(),this.postMessage("s",r.stringify([i,this.transport,this.transUrl,this.baseUrl]));break;case"t":this.emit("message",t.data);break;case"c":var n;try{n=r.parse(t.data)}catch(n){return void d("bad json",t.data)}this.emit("close",n[0],n[1]),this.close()}else d("mismatched window id",t.windowId,this.windowId)}else d("not same origin",e.origin,this.origin)},p.prototype.postMessage=function(e,t){d("postMessage",e,t),this.iframeObj.post(r.stringify({windowId:this.windowId,type:e,data:t||""}),this.origin)},p.prototype.send=function(e){d("send",e),this.postMessage("m",e)},p.enabled=function(){return c.iframeEnabled},p.transportName="iframe",p.roundTrips=2,t.exports=p},{"../utils/event":46,"../utils/iframe":47,"../utils/random":50,"../utils/url":52,"../version":53,debug:void 0,events:3,inherits:54,json3:55}],23:[function(e,t,n){(function(n){"use strict";var o=e("inherits"),r=e("./lib/sender-receiver"),s=e("./receiver/jsonp"),i=e("./sender/jsonp");function a(e){if(!a.enabled())throw new Error("Transport created when disabled");r.call(this,e,"/jsonp",i,s)}o(a,r),a.enabled=function(){return!!n.document},a.transportName="jsonp-polling",a.roundTrips=1,a.needBody=!0,t.exports=a}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./lib/sender-receiver":28,"./receiver/jsonp":31,"./sender/jsonp":33,inherits:54}],24:[function(e,t,n){"use strict";var o=e("inherits"),r=e("../../utils/url"),s=e("./sender-receiver"),i=function(){};function a(e,t,n,o){var a;s.call(this,e,t,(a=o,function(e,t,n){i("create ajax sender",e,t);var o={};"string"==typeof t&&(o.headers={"Content-type":"text/plain"});var s=r.addPath(e,"/xhr_send"),c=new a("POST",s,t,o);return c.once("finish",function(e){if(i("finish",e),c=null,200!==e&&204!==e)return n(new Error("http status "+e));n()}),function(){i("abort"),c.close(),c=null;var e=new Error("Aborted");e.code=1e3,n(e)}}),n,o)}o(a,s),t.exports=a},{"../../utils/url":52,"./sender-receiver":28,debug:void 0,inherits:54}],25:[function(e,t,n){"use strict";var o=e("inherits"),r=e("events").EventEmitter,s=function(){};function i(e,t){s(e),r.call(this),this.sendBuffer=[],this.sender=t,this.url=e}o(i,r),i.prototype.send=function(e){s("send",e),this.sendBuffer.push(e),this.sendStop||this.sendSchedule()},i.prototype.sendScheduleWait=function(){s("sendScheduleWait");var e,t=this;this.sendStop=function(){s("sendStop"),t.sendStop=null,clearTimeout(e)},e=setTimeout(function(){s("timeout"),t.sendStop=null,t.sendSchedule()},25)},i.prototype.sendSchedule=function(){s("sendSchedule",this.sendBuffer.length);var e=this;if(0<this.sendBuffer.length){var t="["+this.sendBuffer.join(",")+"]";this.sendStop=this.sender(this.url,t,function(t){e.sendStop=null,t?(s("error",t),e.emit("close",t.code||1006,"Sending error: "+t),e.close()):e.sendScheduleWait()}),this.sendBuffer=[]}},i.prototype._cleanup=function(){s("_cleanup"),this.removeAllListeners()},i.prototype.close=function(){s("close"),this._cleanup(),this.sendStop&&(this.sendStop(),this.sendStop=null)},t.exports=i},{debug:void 0,events:3,inherits:54}],26:[function(e,t,n){(function(n){"use strict";var o=e("inherits"),r=e("../iframe"),s=e("../../utils/object");t.exports=function(e){function t(t,n){r.call(this,e.transportName,t,n)}return o(t,r),t.enabled=function(t,o){if(!n.document)return!1;var i=s.extend({},o);return i.sameOrigin=!0,e.enabled(i)&&r.enabled()},t.transportName="iframe-"+e.transportName,t.needBody=!0,t.roundTrips=r.roundTrips+e.roundTrips-1,t.facadeTransport=e,t}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/object":49,"../iframe":22,inherits:54}],27:[function(e,t,n){"use strict";var o=e("inherits"),r=e("events").EventEmitter,s=function(){};function i(e,t,n){s(t),r.call(this),this.Receiver=e,this.receiveUrl=t,this.AjaxObject=n,this._scheduleReceiver()}o(i,r),i.prototype._scheduleReceiver=function(){s("_scheduleReceiver");var e=this,t=this.poll=new this.Receiver(this.receiveUrl,this.AjaxObject);t.on("message",function(t){s("message",t),e.emit("message",t)}),t.once("close",function(n,o){s("close",n,o,e.pollIsClosing),e.poll=t=null,e.pollIsClosing||("network"===o?e._scheduleReceiver():(e.emit("close",n||1006,o),e.removeAllListeners()))})},i.prototype.abort=function(){s("abort"),this.removeAllListeners(),this.pollIsClosing=!0,this.poll&&this.poll.abort()},t.exports=i},{debug:void 0,events:3,inherits:54}],28:[function(e,t,n){"use strict";var o=e("inherits"),r=e("../../utils/url"),s=e("./buffered-sender"),i=e("./polling"),a=function(){};function c(e,t,n,o,c){var l=r.addPath(e,t);a(l);var u=this;s.call(this,e,n),this.poll=new i(o,l,c),this.poll.on("message",function(e){a("poll message",e),u.emit("message",e)}),this.poll.once("close",function(e,t){a("poll close",e,t),u.poll=null,u.emit("close",e,t),u.close()})}o(c,s),c.prototype.close=function(){s.prototype.close.call(this),a("close"),this.removeAllListeners(),this.poll&&(this.poll.abort(),this.poll=null)},t.exports=c},{"../../utils/url":52,"./buffered-sender":25,"./polling":27,debug:void 0,inherits:54}],29:[function(e,t,n){"use strict";var o=e("inherits"),r=e("events").EventEmitter,s=e("eventsource"),i=function(){};function a(e){i(e),r.call(this);var t=this,n=this.es=new s(e);n.onmessage=function(e){i("message",e.data),t.emit("message",decodeURI(e.data))},n.onerror=function(e){i("error",n.readyState,e);var o=2!==n.readyState?"network":"permanent";t._cleanup(),t._close(o)}}o(a,r),a.prototype.abort=function(){i("abort"),this._cleanup(),this._close("user")},a.prototype._cleanup=function(){i("cleanup");var e=this.es;e&&(e.onmessage=e.onerror=null,e.close(),this.es=null)},a.prototype._close=function(e){i("close",e);var t=this;setTimeout(function(){t.emit("close",null,e),t.removeAllListeners()},200)},t.exports=a},{debug:void 0,events:3,eventsource:18,inherits:54}],30:[function(e,t,n){(function(n){"use strict";var o=e("inherits"),r=e("../../utils/iframe"),s=e("../../utils/url"),i=e("events").EventEmitter,a=e("../../utils/random"),c=function(){};function l(e){c(e),i.call(this);var t=this;r.polluteGlobalNamespace(),this.id="a"+a.string(6),e=s.addQuery(e,"c="+decodeURIComponent(r.WPrefix+"."+this.id)),c("using htmlfile",l.htmlfileEnabled);var o=l.htmlfileEnabled?r.createHtmlfile:r.createIframe;n[r.WPrefix][this.id]={start:function(){c("start"),t.iframeObj.loaded()},message:function(e){c("message",e),t.emit("message",e)},stop:function(){c("stop"),t._cleanup(),t._close("network")}},this.iframeObj=o(e,function(){c("callback"),t._cleanup(),t._close("permanent")})}o(l,i),l.prototype.abort=function(){c("abort"),this._cleanup(),this._close("user")},l.prototype._cleanup=function(){c("_cleanup"),this.iframeObj&&(this.iframeObj.cleanup(),this.iframeObj=null),delete n[r.WPrefix][this.id]},l.prototype._close=function(e){c("_close",e),this.emit("close",null,e),this.removeAllListeners()},l.htmlfileEnabled=!1;var u=["Active"].concat("Object").join("X");if(u in n)try{l.htmlfileEnabled=!!new n[u]("htmlfile")}catch(o){}l.enabled=l.htmlfileEnabled||r.iframeEnabled,t.exports=l}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/iframe":47,"../../utils/random":50,"../../utils/url":52,debug:void 0,events:3,inherits:54}],31:[function(e,t,n){(function(n){"use strict";var o=e("../../utils/iframe"),r=e("../../utils/random"),s=e("../../utils/browser"),i=e("../../utils/url"),a=e("inherits"),c=e("events").EventEmitter,l=function(){};function u(e){l(e);var t=this;c.call(this),o.polluteGlobalNamespace(),this.id="a"+r.string(6);var s=i.addQuery(e,"c="+encodeURIComponent(o.WPrefix+"."+this.id));n[o.WPrefix][this.id]=this._callback.bind(this),this._createScript(s),this.timeoutId=setTimeout(function(){l("timeout"),t._abort(new Error("JSONP script loaded abnormally (timeout)"))},u.timeout)}a(u,c),u.prototype.abort=function(){if(l("abort"),n[o.WPrefix][this.id]){var e=new Error("JSONP user aborted read");e.code=1e3,this._abort(e)}},u.timeout=35e3,u.scriptErrorTimeout=1e3,u.prototype._callback=function(e){l("_callback",e),this._cleanup(),this.aborting||(e&&(l("message",e),this.emit("message",e)),this.emit("close",null,"network"),this.removeAllListeners())},u.prototype._abort=function(e){l("_abort",e),this._cleanup(),this.aborting=!0,this.emit("close",e.code,e.message),this.removeAllListeners()},u.prototype._cleanup=function(){if(l("_cleanup"),clearTimeout(this.timeoutId),this.script2&&(this.script2.parentNode.removeChild(this.script2),this.script2=null),this.script){var e=this.script;e.parentNode.removeChild(e),e.onreadystatechange=e.onerror=e.onload=e.onclick=null,this.script=null}delete n[o.WPrefix][this.id]},u.prototype._scriptError=function(){l("_scriptError");var e=this;this.errorTimer||(this.errorTimer=setTimeout(function(){e.loadedOkay||e._abort(new Error("JSONP script loaded abnormally (onerror)"))},u.scriptErrorTimeout))},u.prototype._createScript=function(e){l("_createScript",e);var t,o=this,i=this.script=n.document.createElement("script");if(i.id="a"+r.string(8),i.src=e,i.type="text/javascript",i.charset="UTF-8",i.onerror=this._scriptError.bind(this),i.onload=function(){l("onload"),o._abort(new Error("JSONP script loaded abnormally (onload)"))},i.onreadystatechange=function(){if(l("onreadystatechange",i.readyState),/loaded|closed/.test(i.readyState)){if(i&&i.htmlFor&&i.onclick){o.loadedOkay=!0;try{i.onclick()}catch(e){}}i&&o._abort(new Error("JSONP script loaded abnormally (onreadystatechange)"))}},void 0===i.async&&n.document.attachEvent)if(s.isOpera())(t=this.script2=n.document.createElement("script")).text="try{var a = document.getElementById('"+i.id+"'); if(a)a.onerror();}catch(x){};",i.async=t.async=!1;else{try{i.htmlFor=i.id,i.event="onclick"}catch(e){}i.async=!0}void 0!==i.async&&(i.async=!0);var a=n.document.getElementsByTagName("head")[0];a.insertBefore(i,a.firstChild),t&&a.insertBefore(t,a.firstChild)},t.exports=u}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/browser":44,"../../utils/iframe":47,"../../utils/random":50,"../../utils/url":52,debug:void 0,events:3,inherits:54}],32:[function(e,t,n){"use strict";var o=e("inherits"),r=e("events").EventEmitter,s=function(){};function i(e,t){s(e),r.call(this);var n=this;this.bufferPosition=0,this.xo=new t("POST",e,null),this.xo.on("chunk",this._chunkHandler.bind(this)),this.xo.once("finish",function(e,t){s("finish",e,t),n._chunkHandler(e,t),n.xo=null;var o=200===e?"network":"permanent";s("close",o),n.emit("close",null,o),n._cleanup()})}o(i,r),i.prototype._chunkHandler=function(e,t){if(s("_chunkHandler",e),200===e&&t)for(var n=-1;;this.bufferPosition+=n+1){var o=t.slice(this.bufferPosition);if(-1===(n=o.indexOf("\n")))break;var r=o.slice(0,n);r&&(s("message",r),this.emit("message",r))}},i.prototype._cleanup=function(){s("_cleanup"),this.removeAllListeners()},i.prototype.abort=function(){s("abort"),this.xo&&(this.xo.close(),s("close"),this.emit("close",null,"user"),this.xo=null),this._cleanup()},t.exports=i},{debug:void 0,events:3,inherits:54}],33:[function(e,t,n){(function(n){"use strict";var o,r,s=e("../../utils/random"),i=e("../../utils/url"),a=function(){};t.exports=function(e,t,c){a(e,t),o||(a("createForm"),(o=n.document.createElement("form")).style.display="none",o.style.position="absolute",o.method="POST",o.enctype="application/x-www-form-urlencoded",o.acceptCharset="UTF-8",(r=n.document.createElement("textarea")).name="d",o.appendChild(r),n.document.body.appendChild(o));var l="a"+s.string(8);o.target=l,o.action=i.addQuery(i.addPath(e,"/jsonp_send"),"i="+l);var u=function(e){a("createIframe",e);try{return n.document.createElement('<iframe name="'+e+'">')}catch(o){var t=n.document.createElement("iframe");return t.name=e,t}}(l);u.id=l,u.style.display="none",o.appendChild(u);try{r.value=t}catch(e){}function d(e){a("completed",l,e),u.onerror&&(u.onreadystatechange=u.onerror=u.onload=null,setTimeout(function(){a("cleaning up",l),u.parentNode.removeChild(u),u=null},500),r.value="",c(e))}return o.submit(),u.onerror=function(){a("onerror",l),d()},u.onload=function(){a("onload",l),d()},u.onreadystatechange=function(e){a("onreadystatechange",l,u.readyState,e),"complete"===u.readyState&&d()},function(){a("aborted",l),d(new Error("Aborted"))}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/random":50,"../../utils/url":52,debug:void 0}],34:[function(e,t,n){(function(n){"use strict";var o=e("events").EventEmitter,r=e("inherits"),s=e("../../utils/event"),i=e("../../utils/browser"),a=e("../../utils/url"),c=function(){};function l(e,t,n){c(e,t);var r=this;o.call(this),setTimeout(function(){r._start(e,t,n)},0)}r(l,o),l.prototype._start=function(e,t,o){c("_start");var r=this,i=new n.XDomainRequest;t=a.addQuery(t,"t="+ +new Date),i.onerror=function(){c("onerror"),r._error()},i.ontimeout=function(){c("ontimeout"),r._error()},i.onprogress=function(){c("progress",i.responseText),r.emit("chunk",200,i.responseText)},i.onload=function(){c("load"),r.emit("finish",200,i.responseText),r._cleanup(!1)},this.xdr=i,this.unloadRef=s.unloadAdd(function(){r._cleanup(!0)});try{this.xdr.open(e,t),this.timeout&&(this.xdr.timeout=this.timeout),this.xdr.send(o)}catch(e){this._error()}},l.prototype._error=function(){this.emit("finish",0,""),this._cleanup(!1)},l.prototype._cleanup=function(e){if(c("cleanup",e),this.xdr){if(this.removeAllListeners(),s.unloadDel(this.unloadRef),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null,e)try{this.xdr.abort()}catch(e){}this.unloadRef=this.xdr=null}},l.prototype.close=function(){c("close"),this._cleanup(!0)},l.enabled=!(!n.XDomainRequest||!i.hasDomain()),t.exports=l}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/browser":44,"../../utils/event":46,"../../utils/url":52,debug:void 0,events:3,inherits:54}],35:[function(e,t,n){"use strict";var o=e("inherits"),r=e("../driver/xhr");function s(e,t,n,o){r.call(this,e,t,n,o)}o(s,r),s.enabled=r.enabled&&r.supportsCORS,t.exports=s},{"../driver/xhr":17,inherits:54}],36:[function(e,t,n){"use strict";var o=e("events").EventEmitter;function r(){var e=this;o.call(this),this.to=setTimeout(function(){e.emit("finish",200,"{}")},r.timeout)}e("inherits")(r,o),r.prototype.close=function(){clearTimeout(this.to)},r.timeout=2e3,t.exports=r},{events:3,inherits:54}],37:[function(e,t,n){"use strict";var o=e("inherits"),r=e("../driver/xhr");function s(e,t,n){r.call(this,e,t,n,{noCredentials:!0})}o(s,r),s.enabled=r.enabled,t.exports=s},{"../driver/xhr":17,inherits:54}],38:[function(e,t,n){"use strict";var o=e("../utils/event"),r=e("../utils/url"),s=e("inherits"),i=e("events").EventEmitter,a=e("./driver/websocket"),c=function(){};function l(e,t,n){if(!l.enabled())throw new Error("Transport created when disabled");i.call(this),c("constructor",e);var s=this,u=r.addPath(e,"/websocket");u="https"===u.slice(0,5)?"wss"+u.slice(5):"ws"+u.slice(4),this.url=u,this.ws=new a(this.url,[],n),this.ws.onmessage=function(e){c("message event",e.data),s.emit("message",e.data)},this.unloadRef=o.unloadAdd(function(){c("unload"),s.ws.close()}),this.ws.onclose=function(e){c("close event",e.code,e.reason),s.emit("close",e.code,e.reason),s._cleanup()},this.ws.onerror=function(e){c("error event",e),s.emit("close",1006,"WebSocket connection broken"),s._cleanup()}}s(l,i),l.prototype.send=function(e){var t="["+e+"]";c("send",t),this.ws.send(t)},l.prototype.close=function(){c("close");var e=this.ws;this._cleanup(),e&&e.close()},l.prototype._cleanup=function(){c("_cleanup");var e=this.ws;e&&(e.onmessage=e.onclose=e.onerror=null),o.unloadDel(this.unloadRef),this.unloadRef=this.ws=null,this.removeAllListeners()},l.enabled=function(){return c("enabled"),!!a},l.transportName="websocket",l.roundTrips=2,t.exports=l},{"../utils/event":46,"../utils/url":52,"./driver/websocket":19,debug:void 0,events:3,inherits:54}],39:[function(e,t,n){"use strict";var o=e("inherits"),r=e("./lib/ajax-based"),s=e("./xdr-streaming"),i=e("./receiver/xhr"),a=e("./sender/xdr");function c(e){if(!a.enabled)throw new Error("Transport created when disabled");r.call(this,e,"/xhr",i,a)}o(c,r),c.enabled=s.enabled,c.transportName="xdr-polling",c.roundTrips=2,t.exports=c},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xdr":34,"./xdr-streaming":40,inherits:54}],40:[function(e,t,n){"use strict";var o=e("inherits"),r=e("./lib/ajax-based"),s=e("./receiver/xhr"),i=e("./sender/xdr");function a(e){if(!i.enabled)throw new Error("Transport created when disabled");r.call(this,e,"/xhr_streaming",s,i)}o(a,r),a.enabled=function(e){return!e.cookie_needed&&!e.nullOrigin&&i.enabled&&e.sameScheme},a.transportName="xdr-streaming",a.roundTrips=2,t.exports=a},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xdr":34,inherits:54}],41:[function(e,t,n){"use strict";var o=e("inherits"),r=e("./lib/ajax-based"),s=e("./receiver/xhr"),i=e("./sender/xhr-cors"),a=e("./sender/xhr-local");function c(e){if(!a.enabled&&!i.enabled)throw new Error("Transport created when disabled");r.call(this,e,"/xhr",s,i)}o(c,r),c.enabled=function(e){return!e.nullOrigin&&(!(!a.enabled||!e.sameOrigin)||i.enabled)},c.transportName="xhr-polling",c.roundTrips=2,t.exports=c},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xhr-cors":35,"./sender/xhr-local":37,inherits:54}],42:[function(e,t,n){(function(n){"use strict";var o=e("inherits"),r=e("./lib/ajax-based"),s=e("./receiver/xhr"),i=e("./sender/xhr-cors"),a=e("./sender/xhr-local"),c=e("../utils/browser");function l(e){if(!a.enabled&&!i.enabled)throw new Error("Transport created when disabled");r.call(this,e,"/xhr_streaming",s,i)}o(l,r),l.enabled=function(e){return!e.nullOrigin&&!c.isOpera()&&i.enabled},l.transportName="xhr-streaming",l.roundTrips=2,l.needBody=!!n.document,t.exports=l}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utils/browser":44,"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xhr-cors":35,"./sender/xhr-local":37,inherits:54}],43:[function(e,t,n){(function(e){"use strict";e.crypto&&e.crypto.getRandomValues?t.exports.randomBytes=function(t){var n=new Uint8Array(t);return e.crypto.getRandomValues(n),n}:t.exports.randomBytes=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=Math.floor(256*Math.random());return t}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],44:[function(e,t,n){(function(e){"use strict";t.exports={isOpera:function(){return e.navigator&&/opera/i.test(e.navigator.userAgent)},isKonqueror:function(){return e.navigator&&/konqueror/i.test(e.navigator.userAgent)},hasDomain:function(){if(!e.document)return!0;try{return!!e.document.domain}catch(e){return!1}}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],45:[function(e,t,n){"use strict";var o,r=e("json3"),s=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g;t.exports={quote:function(e){var t=r.stringify(e);return s.lastIndex=0,s.test(t)?(o=o||function(e){var t,n={},o=[];for(t=0;t<65536;t++)o.push(String.fromCharCode(t));return e.lastIndex=0,o.join("").replace(e,function(e){return n[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,n}(s),t.replace(s,function(e){return o[e]})):t}}},{json3:55}],46:[function(e,t,n){(function(n){"use strict";var o=e("./random"),r={},s=!1,i=n.chrome&&n.chrome.app&&n.chrome.app.runtime;t.exports={attachEvent:function(e,t){void 0!==n.addEventListener?n.addEventListener(e,t,!1):n.document&&n.attachEvent&&(n.document.attachEvent("on"+e,t),n.attachEvent("on"+e,t))},detachEvent:function(e,t){void 0!==n.addEventListener?n.removeEventListener(e,t,!1):n.document&&n.detachEvent&&(n.document.detachEvent("on"+e,t),n.detachEvent("on"+e,t))},unloadAdd:function(e){if(i)return null;var t=o.string(8);return r[t]=e,s&&setTimeout(this.triggerUnloadCallbacks,0),t},unloadDel:function(e){e in r&&delete r[e]},triggerUnloadCallbacks:function(){for(var e in r)r[e](),delete r[e]}},i||t.exports.attachEvent("unload",function(){s||(s=!0,t.exports.triggerUnloadCallbacks())})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./random":50}],47:[function(e,t,n){(function(n){"use strict";var o=e("./event"),r=e("json3"),s=e("./browser"),i=function(){};t.exports={WPrefix:"_jp",currentWindowId:null,polluteGlobalNamespace:function(){t.exports.WPrefix in n||(n[t.exports.WPrefix]={})},postMessage:function(e,o){n.parent!==n?n.parent.postMessage(r.stringify({windowId:t.exports.currentWindowId,type:e,data:o||""}),"*"):i("Cannot postMessage, no parent window.",e,o)},createIframe:function(e,t){function r(){i("unattach"),clearTimeout(c);try{u.onload=null}catch(e){}u.onerror=null}function s(){i("cleanup"),u&&(r(),setTimeout(function(){u&&u.parentNode.removeChild(u),u=null},0),o.unloadDel(l))}function a(e){i("onerror",e),u&&(s(),t(e))}var c,l,u=n.document.createElement("iframe");return u.src=e,u.style.display="none",u.style.position="absolute",u.onerror=function(){a("onerror")},u.onload=function(){i("onload"),clearTimeout(c),c=setTimeout(function(){a("onload timeout")},2e3)},n.document.body.appendChild(u),c=setTimeout(function(){a("timeout")},15e3),l=o.unloadAdd(s),{post:function(e,t){i("post",e,t),setTimeout(function(){try{u&&u.contentWindow&&u.contentWindow.postMessage(e,t)}catch(e){}},0)},cleanup:s,loaded:r}},createHtmlfile:function(e,r){function s(){clearTimeout(l),d.onerror=null}function a(){f&&(s(),o.unloadDel(u),d.parentNode.removeChild(d),d=f=null,CollectGarbage())}function c(e){i("onerror",e),f&&(a(),r(e))}var l,u,d,p=["Active"].concat("Object").join("X"),f=new n[p]("htmlfile");f.open(),f.write('<html><script>document.domain="'+n.document.domain+'";<\/script></html>'),f.close(),f.parentWindow[t.exports.WPrefix]=n[t.exports.WPrefix];var h=f.createElement("div");return f.body.appendChild(h),d=f.createElement("iframe"),h.appendChild(d),d.src=e,d.onerror=function(){c("onerror")},l=setTimeout(function(){c("timeout")},15e3),u=o.unloadAdd(a),{post:function(e,t){try{setTimeout(function(){d&&d.contentWindow&&d.contentWindow.postMessage(e,t)},0)}catch(e){}},cleanup:a,loaded:s}}},t.exports.iframeEnabled=!1,n.document&&(t.exports.iframeEnabled=("function"==typeof n.postMessage||"object"==typeof n.postMessage)&&!s.isKonqueror())}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./browser":44,"./event":46,debug:void 0,json3:55}],48:[function(e,t,n){(function(e){"use strict";var n={};["log","debug","warn"].forEach(function(t){var o;try{o=e.console&&e.console[t]&&e.console[t].apply}catch(t){}n[t]=o?function(){return e.console[t].apply(e.console,arguments)}:"log"===t?function(){}:n.log}),t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],49:[function(e,t,n){"use strict";t.exports={isObject:function(e){var t=typeof e;return"function"==t||"object"==t&&!!e},extend:function(e){if(!this.isObject(e))return e;for(var t,n,o=1,r=arguments.length;o<r;o++)for(n in t=arguments[o])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}}},{}],50:[function(e,t,n){"use strict";var o=e("crypto"),r="abcdefghijklmnopqrstuvwxyz012345";t.exports={string:function(e){for(var t=r.length,n=o.randomBytes(e),s=[],i=0;i<e;i++)s.push(r.substr(n[i]%t,1));return s.join("")},number:function(e){return Math.floor(Math.random()*e)},numberString:function(e){var t=(""+(e-1)).length;return(new Array(t+1).join("0")+this.number(e)).slice(-t)}}},{crypto:43}],51:[function(e,t,n){"use strict";t.exports=function(e){return{filterToEnabled:function(t,n){var o={main:[],facade:[]};return t?"string"==typeof t&&(t=[t]):t=[],e.forEach(function(e){e&&("websocket"!==e.transportName||!1!==n.websocket)&&(t.length&&-1===t.indexOf(e.transportName)?e.transportName:e.enabled(n)?(e.transportName,o.main.push(e),e.facadeTransport&&o.facade.push(e.facadeTransport)):e.transportName)}),o}}}},{debug:void 0}],52:[function(e,t,n){"use strict";var o=e("url-parse");t.exports={getOrigin:function(e){if(!e)return null;var t=new o(e);if("file:"===t.protocol)return null;var n=t.port;return n=n||("https:"===t.protocol?"443":"80"),t.protocol+"//"+t.hostname+":"+n},isOriginEqual:function(e,t){var n=this.getOrigin(e)===this.getOrigin(t);return n},isSchemeEqual:function(e,t){return e.split(":")[0]===t.split(":")[0]},addPath:function(e,t){var n=e.split("?");return n[0]+t+(n[1]?"?"+n[1]:"")},addQuery:function(e,t){return e+(-1===e.indexOf("?")?"?"+t:"&"+t)}}},{debug:void 0,"url-parse":58}],53:[function(e,t,n){t.exports="1.4.0"},{}],54:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){function n(){}e.super_=t,n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],55:[function(e,t,n){(function(e){(function(){var o={function:!0,object:!0},r=o[typeof n]&&n&&!n.nodeType&&n,s=o[typeof window]&&window||this,i=r&&o[typeof t]&&t&&!t.nodeType&&"object"==typeof e&&e;function a(e,t){e=e||s.Object(),t=t||s.Object();var n=e.Number||s.Number,r=e.String||s.String,i=e.Object||s.Object,c=e.Date||s.Date,l=e.SyntaxError||s.SyntaxError,u=e.TypeError||s.TypeError,d=e.Math||s.Math,p=e.JSON||s.JSON;"object"==typeof p&&p&&(t.stringify=p.stringify,t.parse=p.parse);var f,h,m,g=i.prototype,v=g.toString,y=new c(-0xc782b5b800cec);try{y=-109252==y.getUTCFullYear()&&0===y.getUTCMonth()&&1===y.getUTCDate()&&10==y.getUTCHours()&&37==y.getUTCMinutes()&&6==y.getUTCSeconds()&&708==y.getUTCMilliseconds()}catch(e){}function b(e){if(b[e]!==m)return b[e];var o;if("bug-string-char-index"==e)o="a"!="a"[0];else if("json"==e)o=b("json-stringify")&&b("json-parse");else{var s,i='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var a=t.stringify,l="function"==typeof a&&y;if(l){(s=function(){return 1}).toJSON=s;try{l="0"===a(0)&&"0"===a(new n)&&'""'==a(new r)&&a(v)===m&&a(m)===m&&a()===m&&"1"===a(s)&&"[1]"==a([s])&&"[null]"==a([m])&&"null"==a(null)&&"[null,null,null]"==a([m,v,null])&&a({a:[s,!0,!1,null,"\0\b\n\f\r\t"]})==i&&"1"===a(null,s)&&"[\n 1,\n 2\n]"==a([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==a(new c(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==a(new c(864e13))&&'"-000001-01-01T00:00:00.000Z"'==a(new c(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==a(new c(-1))}catch(e){l=!1}}o=l}if("json-parse"==e){var u=t.parse;if("function"==typeof u)try{if(0===u("0")&&!u(!1)){var d=5==(s=u(i)).a.length&&1===s.a[0];if(d){try{d=!u('"\t"')}catch(e){}if(d)try{d=1!==u("01")}catch(e){}if(d)try{d=1!==u("1.")}catch(e){}}}}catch(e){d=!1}o=d}}return b[e]=!!o}if(!b("json")){var w="[object Function]",S="[object Number]",C="[object String]",A="[object Array]",I=b("bug-string-char-index");if(!y)var M=d.floor,_=[0,31,59,90,120,151,181,212,243,273,304,334],T=function(e,t){return _[t]+365*(e-1970)+M((e-1969+(t=+(1<t)))/4)-M((e-1901+t)/100)+M((e-1601+t)/400)};if((f=g.hasOwnProperty)||(f=function(e){var t,n={};return f=(n.__proto__=null,n.__proto__={toString:1},n).toString!=v?function(e){var t=this.__proto__,n=e in(this.__proto__=null,this);return this.__proto__=t,n}:(t=n.constructor,function(e){var n=(this.constructor||t).prototype;return e in this&&!(e in n&&this[e]===n[e])}),n=null,f.call(this,e)}),h=function(e,t){var n,r,s,i=0;for(s in(n=function(){this.valueOf=0}).prototype.valueOf=0,r=new n)f.call(r,s)&&i++;return n=r=null,(h=i?2==i?function(e,t){var n,o={},r=v.call(e)==w;for(n in e)r&&"prototype"==n||f.call(o,n)||!(o[n]=1)||!f.call(e,n)||t(n)}:function(e,t){var n,o,r=v.call(e)==w;for(n in e)r&&"prototype"==n||!f.call(e,n)||(o="constructor"===n)||t(n);(o||f.call(e,n="constructor"))&&t(n)}:(r=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],function(e,t){var n,s,i=v.call(e)==w,a=!i&&"function"!=typeof e.constructor&&o[typeof e.hasOwnProperty]&&e.hasOwnProperty||f;for(n in e)i&&"prototype"==n||!a.call(e,n)||t(n);for(s=r.length;n=r[--s];a.call(e,n)&&t(n));}))(e,t)},!b("json-stringify")){function k(e,t){return("000000"+(t||0)).slice(-e)}function x(e){for(var t='"',n=0,o=e.length,r=!I||10<o,s=r&&(I?e.split(""):e);n<o;n++){var i=e.charCodeAt(n);switch(i){case 8:case 9:case 10:case 12:case 13:case 34:case 92:t+=E[i];break;default:if(i<32){t+="\\u00"+k(2,i.toString(16));break}t+=r?s[n]:e.charAt(n)}}return t+'"'}var E={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},O=function(e,t,n,o,r,s,i){var a,c,l,d,p,g,y,b,w,I,_,E,L,N,U,j;try{a=t[e]}catch(e){}if("object"==typeof a&&a)if("[object Date]"!=(c=v.call(a))||f.call(a,"toJSON"))"function"==typeof a.toJSON&&(c!=S&&c!=C&&c!=A||f.call(a,"toJSON"))&&(a=a.toJSON(e));else if(-1/0<a&&a<1/0){if(T){for(p=M(a/864e5),l=M(p/365.2425)+1970-1;T(l+1,0)<=p;l++);for(d=M((p-T(l,0))/30.42);T(l,d+1)<=p;d++);p=1+p-T(l,d),y=M((g=(a%864e5+864e5)%864e5)/36e5)%24,b=M(g/6e4)%60,w=M(g/1e3)%60,I=g%1e3}else l=a.getUTCFullYear(),d=a.getUTCMonth(),p=a.getUTCDate(),y=a.getUTCHours(),b=a.getUTCMinutes(),w=a.getUTCSeconds(),I=a.getUTCMilliseconds();a=(l<=0||1e4<=l?(l<0?"-":"+")+k(6,l<0?-l:l):k(4,l))+"-"+k(2,d+1)+"-"+k(2,p)+"T"+k(2,y)+":"+k(2,b)+":"+k(2,w)+"."+k(3,I)+"Z"}else a=null;if(n&&(a=n.call(t,e,a)),null===a)return"null";if("[object Boolean]"==(c=v.call(a)))return""+a;if(c==S)return-1/0<a&&a<1/0?""+a:"null";if(c==C)return x(""+a);if("object"==typeof a){for(N=i.length;N--;)if(i[N]===a)throw u();if(i.push(a),_=[],U=s,s+=r,c==A){for(L=0,N=a.length;L<N;L++)E=O(L,a,n,o,r,s,i),_.push(E===m?"null":E);j=_.length?r?"[\n"+s+_.join(",\n"+s)+"\n"+U+"]":"["+_.join(",")+"]":"[]"}else h(o||a,function(e){var t=O(e,a,n,o,r,s,i);t!==m&&_.push(x(e)+":"+(r?" ":"")+t)}),j=_.length?r?"{\n"+s+_.join(",\n"+s)+"\n"+U+"}":"{"+_.join(",")+"}":"{}";return i.pop(),j}};t.stringify=function(e,t,n){var r,s,i,a;if(o[typeof t]&&t)if((a=v.call(t))==w)s=t;else if(a==A){i={};for(var c,l=0,u=t.length;l<u;c=t[l++],(a=v.call(c))!=C&&a!=S||(i[c]=1));}if(n)if((a=v.call(n))==S){if(0<(n-=n%1))for(r="",10<n&&(n=10);r.length<n;r+=" ");}else a==C&&(r=n.length<=10?n:n.slice(0,10));return O("",((c={})[""]=e,c),s,i,r,"",[])}}if(!b("json-parse")){function L(){throw j=P=null,l()}function N(){for(var e,t,n,o,r,s=P,i=s.length;j<i;)switch(r=s.charCodeAt(j)){case 9:case 10:case 13:case 32:j++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=I?s.charAt(j):s[j],j++,e;case 34:for(e="@",j++;j<i;)if((r=s.charCodeAt(j))<32)L();else if(92==r)switch(r=s.charCodeAt(++j)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=R[r],j++;break;case 117:for(t=++j,n=j+4;j<n;j++)48<=(r=s.charCodeAt(j))&&r<=57||97<=r&&r<=102||65<=r&&r<=70||L();e+=G("0x"+s.slice(t,j));break;default:L()}else{if(34==r)break;for(r=s.charCodeAt(j),t=j;32<=r&&92!=r&&34!=r;)r=s.charCodeAt(++j);e+=s.slice(t,j)}if(34==s.charCodeAt(j))return j++,e;L();default:if(t=j,45==r&&(o=!0,r=s.charCodeAt(++j)),48<=r&&r<=57){for(48==r&&48<=(r=s.charCodeAt(j+1))&&r<=57&&L(),o=!1;j<i&&48<=(r=s.charCodeAt(j))&&r<=57;j++);if(46==s.charCodeAt(j)){for(n=++j;n<i&&48<=(r=s.charCodeAt(n))&&r<=57;n++);n==j&&L(),j=n}if(101==(r=s.charCodeAt(j))||69==r){for(43!=(r=s.charCodeAt(++j))&&45!=r||j++,n=j;n<i&&48<=(r=s.charCodeAt(n))&&r<=57;n++);n==j&&L(),j=n}return+s.slice(t,j)}if(o&&L(),"true"==s.slice(j,j+4))return j+=4,!0;if("false"==s.slice(j,j+5))return j+=5,!1;if("null"==s.slice(j,j+4))return j+=4,null;L()}return"$"}function U(e,t,n){var o=D(e,t,n);o===m?delete e[t]:e[t]=o}var j,P,G=r.fromCharCode,R={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},z=function(e){var t,n;if("$"==e&&L(),"string"==typeof e){if("@"==(I?e.charAt(0):e[0]))return e.slice(1);if("["==e){for(t=[];"]"!=(e=N());n=n||!0)n&&(","==e?"]"==(e=N())&&L():L()),","==e&&L(),t.push(z(e));return t}if("{"==e){for(t={};"}"!=(e=N());n=n||!0)n&&(","==e?"}"==(e=N())&&L():L()),","!=e&&"string"==typeof e&&"@"==(I?e.charAt(0):e[0])&&":"==N()||L(),t[e.slice(1)]=z(N());return t}L()}return e},D=function(e,t,n){var o,r=e[t];if("object"==typeof r&&r)if(v.call(r)==A)for(o=r.length;o--;)U(r,o,n);else h(r,function(e){U(r,e,n)});return n.call(e,t,r)};t.parse=function(e,t){var n,o;return j=0,P=""+e,n=z(N()),"$"!=N()&&L(),j=P=null,t&&v.call(t)==w?D(((o={})[""]=n,o),"",t):n}}}return t.runInContext=a,t}if(!i||i.global!==i&&i.window!==i&&i.self!==i||(s=i),r)a(s,r);else{var c=s.JSON,l=s.JSON3,u=!1,d=a(s,s.JSON3={noConflict:function(){return u||(u=!0,s.JSON=c,s.JSON3=l,c=l=null),d}});s.JSON={parse:d.parse,stringify:d.stringify}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],56:[function(e,t,n){"use strict";var o=Object.prototype.hasOwnProperty;function r(e){return decodeURIComponent(e.replace(/\+/g," "))}n.stringify=function(e,t){t=t||"";var n=[];for(var r in"string"!=typeof t&&(t="?"),e)o.call(e,r)&&n.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return n.length?t+n.join("&"):""},n.parse=function(e){for(var t,n=/([^=?&]+)=?([^&]*)/g,o={};t=n.exec(e);){var s=r(t[1]),i=r(t[2]);s in o||(o[s]=i)}return o}},{}],57:[function(e,t,n){"use strict";t.exports=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}},{}],58:[function(e,t,n){(function(n){"use strict";var o=e("requires-port"),r=e("querystringify"),s=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\S\s]*)/i,i=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,a=[["#","hash"],["?","query"],function(e){return e.replace("\\","/")},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d+)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],c={hash:1,query:1};function l(e){var t,o=n&&n.location||{},r={},s=typeof(e=e||o);if("blob:"===e.protocol)r=new d(unescape(e.pathname),{});else if("string"==s)for(t in r=new d(e,{}),c)delete r[t];else if("object"==s){for(t in e)t in c||(r[t]=e[t]);void 0===r.slashes&&(r.slashes=i.test(e.href))}return r}function u(e){var t=s.exec(e);return{protocol:t[1]?t[1].toLowerCase():"",slashes:!!t[2],rest:t[3]}}function d(e,t,n){if(!(this instanceof d))return new d(e,t,n);var s,i,c,p,f,h,m=a.slice(),g=typeof t,v=this,y=0;for("object"!=g&&"string"!=g&&(n=t,t=null),n&&"function"!=typeof n&&(n=r.parse),t=l(t),s=!(i=u(e||"")).protocol&&!i.slashes,v.slashes=i.slashes||s&&t.slashes,v.protocol=i.protocol||t.protocol||"",e=i.rest,i.slashes||(m[3]=[/(.*)/,"pathname"]);y<m.length;y++)"function"!=typeof(p=m[y])?(c=p[0],h=p[1],c!=c?v[h]=e:"string"==typeof c?~(f=e.indexOf(c))&&(e="number"==typeof p[2]?(v[h]=e.slice(0,f),e.slice(f+p[2])):(v[h]=e.slice(f),e.slice(0,f))):(f=c.exec(e))&&(v[h]=f[1],e=e.slice(0,f.index)),v[h]=v[h]||s&&p[3]&&t[h]||"",p[4]&&(v[h]=v[h].toLowerCase())):e=p(e);n&&(v.query=n(v.query)),s&&t.slashes&&"/"!==v.pathname.charAt(0)&&(""!==v.pathname||""!==t.pathname)&&(v.pathname=function(e,t){for(var n=(t||"/").split("/").slice(0,-1).concat(e.split("/")),o=n.length,r=n[o-1],s=!1,i=0;o--;)"."===n[o]?n.splice(o,1):".."===n[o]?(n.splice(o,1),i++):i&&(0===o&&(s=!0),n.splice(o,1),i--);return s&&n.unshift(""),"."!==r&&".."!==r||n.push(""),n.join("/")}(v.pathname,t.pathname)),o(v.port,v.protocol)||(v.host=v.hostname,v.port=""),v.username=v.password="",v.auth&&(p=v.auth.split(":"),v.username=p[0]||"",v.password=p[1]||""),v.origin=v.protocol&&v.host&&"file:"!==v.protocol?v.protocol+"//"+v.host:"null",v.href=v.toString()}d.prototype={set:function(e,t,n){var s=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(n||r.parse)(t)),s[e]=t;break;case"port":s[e]=t,o(t,s.protocol)?t&&(s.host=s.hostname+":"+t):(s.host=s.hostname,s[e]="");break;case"hostname":s[e]=t,s.port&&(t+=":"+s.port),s.host=t;break;case"host":s[e]=t,/:\d+$/.test(t)?(t=t.split(":"),s.port=t.pop(),s.hostname=t.join(":")):(s.hostname=t,s.port="");break;case"protocol":s.protocol=t.toLowerCase(),s.slashes=!n;break;case"pathname":case"hash":if(t){var i="pathname"===e?"/":"#";s[e]=t.charAt(0)!==i?i+t:t}else s[e]=t;break;default:s[e]=t}for(var c=0;c<a.length;c++){var l=a[c];l[4]&&(s[l[1]]=s[l[1]].toLowerCase())}return s.origin=s.protocol&&s.host&&"file:"!==s.protocol?s.protocol+"//"+s.host:"null",s.href=s.toString(),s},toString:function(e){e&&"function"==typeof e||(e=r.stringify);var t,n=this,o=n.protocol;o&&":"!==o.charAt(o.length-1)&&(o+=":");var s=o+(n.slashes?"//":"");return n.username&&(s+=n.username,n.password&&(s+=":"+n.password),s+="@"),s+=n.host+n.pathname,(t="object"==typeof n.query?e(n.query):n.query)&&(s+="?"!==t.charAt(0)?"?"+t:t),n.hash&&(s+=n.hash),s}},d.extractProtocol=u,d.location=l,d.qs=r,t.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{querystringify:56,"requires-port":57}]},{},[1])(1)}),function(){var e,t,n,o,r={}.hasOwnProperty,s=[].slice;e={LF:"\n",NULL:"\0"},n=function(){var t;function n(e,t,n){this.command=e,this.headers=null!=t?t:{},this.body=null!=n?n:""}return n.prototype.toString=function(){var t,o,s,i,a;for(o in t=[this.command],(s=!1===this.headers["content-length"])&&delete this.headers["content-length"],a=this.headers)r.call(a,o)&&(i=a[o],t.push(o+":"+i));return this.body&&!s&&t.push("content-length:"+n.sizeOfUTF8(this.body)),t.push(e.LF+this.body),t.join(e.LF)},n.sizeOfUTF8=function(e){return e?encodeURI(e).match(/%..|./g).length:0},t=function(t){var o,r,s,i,a,c,l,u,d,p,f,h,m,g,v,y,b;for(i=t.search(RegExp(""+e.LF+e.LF)),s=(a=t.substring(0,i).split(e.LF)).shift(),c={},h=function(e){return e.replace(/^\s+|\s+$/g,"")},m=0,v=(y=a.reverse()).length;m<v;m++)u=(p=y[m]).indexOf(":"),c[h(p.substring(0,u))]=h(p.substring(u+1));if(o="",f=i+2,c["content-length"])d=parseInt(c["content-length"]),o=(""+t).substring(f,f+d);else for(r=null,l=g=f,b=t.length;(f<=b?g<b:g>b)&&(r=t.charAt(l))!==e.NULL;l=f<=b?++g:--g)o+=r;return new n(s,c,o)},n.unmarshall=function(n){var o;return function(){var r,s,i,a;for(a=[],r=0,s=(i=n.split(RegExp(""+e.NULL+e.LF+"*"))).length;r<s;r++)(null!=(o=i[r])?o.length:void 0)>0&&a.push(t(o));return a}()},n.marshall=function(t,o,r){return new n(t,o,r).toString()+e.NULL},n}(),t=function(){var t;function r(e){this.ws=e,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={}}return r.prototype.debug=function(e){var t;return"undefined"!=typeof window&&null!==window&&null!=(t=window.console)?t.log(e):void 0},t=function(){return Date.now?Date.now():(new Date).valueOf},r.prototype._transmit=function(e,t,o){var r;for(r=n.marshall(e,t,o),"function"==typeof this.debug&&this.debug(">>> "+r);;){if(!(r.length>this.maxWebSocketFrameSize))return this.ws.send(r);this.ws.send(r.substring(0,this.maxWebSocketFrameSize)),r=r.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+r.length)}},r.prototype._setupHeartbeat=function(n){var r,s,i,a,c,l;if((c=n.version)===o.VERSIONS.V1_1||c===o.VERSIONS.V1_2)return s=(l=function(){var e,t,o,r;for(r=[],e=0,t=(o=n["heart-beat"].split(",")).length;e<t;e++)a=o[e],r.push(parseInt(a));return r}())[0],r=l[1],0!==this.heartbeat.outgoing&&0!==r&&(i=Math.max(this.heartbeat.outgoing,r),"function"==typeof this.debug&&this.debug("send PING every "+i+"ms"),this.pinger=o.setInterval(i,function(t){return function(){return t.ws.send(e.LF),"function"==typeof t.debug?t.debug(">>> PING"):void 0}}(this))),0!==this.heartbeat.incoming&&0!==s?(i=Math.max(this.heartbeat.incoming,s),"function"==typeof this.debug&&this.debug("check PONG every "+i+"ms"),this.ponger=o.setInterval(i,function(e){return function(){var n;if((n=t()-e.serverActivity)>2*i)return"function"==typeof e.debug&&e.debug("did not receive server activity for the last "+n+"ms"),e.ws.close()}}(this))):void 0},r.prototype._parseConnect=function(){var e,t,n,o;switch(o={},(e=1<=arguments.length?s.call(arguments,0):[]).length){case 2:o=e[0],t=e[1];break;case 3:e[1]instanceof Function?(o=e[0],t=e[1],n=e[2]):(o.login=e[0],o.passcode=e[1],t=e[2]);break;case 4:o.login=e[0],o.passcode=e[1],t=e[2],n=e[3];break;default:o.login=e[0],o.passcode=e[1],t=e[2],n=e[3],o.host=e[4]}return[o,t,n]},r.prototype.connect=function(){var r,i,a,c;return r=1<=arguments.length?s.call(arguments,0):[],c=this._parseConnect.apply(this,r),a=c[0],this.connectCallback=c[1],i=c[2],"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(o){return function(r){var s,a,c,l,u,d,p,f,h,m,g,v;if(l="undefined"!=typeof ArrayBuffer&&r.data instanceof ArrayBuffer?(s=new Uint8Array(r.data),"function"==typeof o.debug&&o.debug("--- got data length: "+s.length),function(){var e,t,n;for(n=[],e=0,t=s.length;e<t;e++)a=s[e],n.push(String.fromCharCode(a));return n}().join("")):r.data,o.serverActivity=t(),l!==e.LF){for("function"==typeof o.debug&&o.debug("<<< "+l),v=[],h=0,m=(g=n.unmarshall(l)).length;h<m;h++)switch((u=g[h]).command){case"CONNECTED":"function"==typeof o.debug&&o.debug("connected to server "+u.headers.server),o.connected=!0,o._setupHeartbeat(u.headers),v.push("function"==typeof o.connectCallback?o.connectCallback(u):void 0);break;case"MESSAGE":f=u.headers.subscription,(p=o.subscriptions[f]||o.onreceive)?(c=o,d=u.headers["message-id"],u.ack=function(e){return null==e&&(e={}),c.ack(d,f,e)},u.nack=function(e){return null==e&&(e={}),c.nack(d,f,e)},v.push(p(u))):v.push("function"==typeof o.debug?o.debug("Unhandled received MESSAGE: "+u):void 0);break;case"RECEIPT":v.push("function"==typeof o.onreceipt?o.onreceipt(u):void 0);break;case"ERROR":v.push("function"==typeof i?i(u):void 0);break;default:v.push("function"==typeof o.debug?o.debug("Unhandled frame: "+u):void 0)}return v}"function"==typeof o.debug&&o.debug("<<< PONG")}}(this),this.ws.onclose=function(e){return function(){var t;return t="Whoops! Lost connection to "+e.ws.url,"function"==typeof e.debug&&e.debug(t),e._cleanUp(),"function"==typeof i?i(t):void 0}}(this),this.ws.onopen=function(e){return function(){return"function"==typeof e.debug&&e.debug("Web Socket Opened..."),a["accept-version"]=o.VERSIONS.supportedVersions(),a["heart-beat"]=[e.heartbeat.outgoing,e.heartbeat.incoming].join(","),e._transmit("CONNECT",a)}}(this)},r.prototype.disconnect=function(e,t){return null==t&&(t={}),this._transmit("DISCONNECT",t),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof e?e():void 0},r.prototype._cleanUp=function(){if(this.connected=!1,this.pinger&&o.clearInterval(this.pinger),this.ponger)return o.clearInterval(this.ponger)},r.prototype.send=function(e,t,n){return null==t&&(t={}),null==n&&(n=""),t.destination=e,this._transmit("SEND",t,n)},r.prototype.subscribe=function(e,t,n){var o;return null==n&&(n={}),n.id||(n.id="sub-"+this.counter++),n.destination=e,this.subscriptions[n.id]=t,this._transmit("SUBSCRIBE",n),o=this,{id:n.id,unsubscribe:function(){return o.unsubscribe(n.id)}}},r.prototype.unsubscribe=function(e){return delete this.subscriptions[e],this._transmit("UNSUBSCRIBE",{id:e})},r.prototype.begin=function(e){var t,n;return n=e||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:n}),t=this,{id:n,commit:function(){return t.commit(n)},abort:function(){return t.abort(n)}}},r.prototype.commit=function(e){return this._transmit("COMMIT",{transaction:e})},r.prototype.abort=function(e){return this._transmit("ABORT",{transaction:e})},r.prototype.ack=function(e,t,n){return null==n&&(n={}),n["message-id"]=e,n.subscription=t,this._transmit("ACK",n)},r.prototype.nack=function(e,t,n){return null==n&&(n={}),n["message-id"]=e,n.subscription=t,this._transmit("NACK",n)},r}(),o={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(e,n){var r;return null==n&&(n=["v10.stomp","v11.stomp"]),r=new(o.WebSocketClass||WebSocket)(e,n),new t(r)},over:function(e){return new t(e)},Frame:n},"undefined"!=typeof exports&&null!==exports&&(exports.Stomp=o),"undefined"!=typeof window&&null!==window?(o.setInterval=function(e,t){return window.setInterval(t,e)},o.clearInterval=function(e){return window.clearInterval(e)},window.Stomp=o):exports||(self.Stomp=o)}.call(this);var MCK_LABELS,MCK_BASE_URL,w=window,d=document,MCK_CURR_LATITIUDE=40.7324319,MCK_CURR_LONGITUDE=-73.82480777777776,mckUtils=new MckUtils,mckDateUtils=new MckDateUtils,mckContactUtils=new MckContactUtils,mckMapUtils=new MckMapUtils;function MckUtils(){var e=this,t=["p","div","pre","form"];e.init=function(){var e=MCK_CONTEXTPATH?MCK_CONTEXTPATH+"/v2/tab/initialize.page":"https://apps.applozic.com/v2/tab/initialize.page",t=MCK_CONTEXTPATH?MCK_CONTEXTPATH+"/rest/ws/message/list":"https://apps.applozic.com/rest/ws/message/list";$applozic.ajax({url:e,contentType:"application/json",type:"OPTIONS"}).done(function(e){}),$applozic.ajax({url:t,contentType:"application/json",type:"OPTIONS"}).done(function(e){})},e.showElement=function(e){("object"!=typeof e&&void 0!==e&&null!==typeof e||e&&"object"==typeof e&&0!==e.length)&&(e.classList.remove("n-vis"),e.classList.add("vis"))},e.hideElement=function(e){("object"!=typeof e&&void 0!==e&&null!==typeof e||e&&"object"==typeof e&&0!==e.length)&&(e.classList.remove("vis"),e.classList.add("n-vis"))},e.badgeCountOnLaucher=function(e,t){var n=document.getElementById("applozic-badge-count");!0===e&&t>0&&(n.innerHTML=t<99?t:"99+",n.classList.add("mck-badge-count")),!0===e&&0===t&&(n.innerHTML="",n.classList.remove("mck-badge-count"))},e.randomId=function(){return w.Math.random().toString(36).substring(7)},e.textVal=function(e){for(var n=[],o=[],r=function(){n.push(o.join("")),o=[]},s=function(e){if(3===e.nodeType)o.push(e.nodeValue);else if(1===e.nodeType){var n=e.tagName.toLowerCase(),i=-1!==t.indexOf(n);if(i&&o.length&&r(),"img"===n){var a=e.getAttribute("alt")||"";return void(a&&o.push(a))}if("style"===n)return;"br"===n&&r();for(var c=e.childNodes,l=0;l<c.length;l++)s(c[l]);i&&o.length&&r()}},i=e.childNodes,a=0;a<i.length;a++)s(i[a]);return o.length&&r(),n.join("\n")},e.mouseX=function(e){return e.pageX?e.pageX:e.clientX?e.clientX+(d.documentElement.scrollLeft?d.documentElement.scrollLeft:d.body.scrollLeft):null},e.mouseY=function(e){return e.pageY?e.pageY:e.clientY?e.clientY+(d.documentElement.scrollTop?d.documentElement.scrollTop:d.body.scrollTop):null},e.startsWith=function(e,t){if(null===t||void 0===e)return!1;var n=t.length;if(e.length<n)return!1;for(--n;n>=0&&e[n]===t[n];--n)continue;return n<0},e.setEndOfContenteditable=function(e){var t,n;document.createRange?((t=document.createRange()).selectNodeContents(e),t.collapse(!1),(n=window.getSelection()).removeAllRanges(),n.addRange(t)):document.selection&&((t=document.body.createTextRange()).moveToElementText(e),t.collapse(!1),t.select())},e.b64EncodeUnicode=function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}))},e.b64DecodeUnicode=function(e){return decodeURIComponent(Array.prototype.map.call(atob(e),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))},e.checkIfB64Encoded=function(e){return/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/.test(e)},e.encrypt=function(e,t){if(!t)return e;for(;e&&e.length%16!=0;)e+=" ";var n=aesjs.util.convertStringToBytes(t),o=new aesjs.ModeOfOperation.ecb(n),r=aesjs.util.convertStringToBytes(e),s=o.encrypt(r),i=String.fromCharCode.apply(null,s);return btoa(i)},e.decrypt=function(e,t){if(!t)return e;for(var n=aesjs.util.convertStringToBytes(t),o=atob(e),r=[],s=0;s<o.length;s++)r.push(o.charCodeAt(s));var i=new aesjs.ModeOfOperation.ecb(n).decrypt(r);return aesjs.util.convertBytesToString(i).replace(/\\u0000/g,"").replace(/^\s*|\s*[\x00-\x10]*$/g,"")},e.ajax=function(t){var n=$applozic.extend({},{},t);!t.skipEncryption&&t.encryptionKey&&("post"===n.type.toLowerCase()&&(n.data=encrypt(t.data,t.encryptionKey)),n.success=function(n){var o=e.decrypt(n,t.encryptionKey);mckUtils.isJsonString(o)?t.success(JSON.parse(o)):t.success(o)}),$applozic.ajax(n)},e.isJsonString=function(e){try{JSON.parse(e)}catch(e){return!1}return!0}}function MckContactUtils(){var e=this;e.getContactId=function(t){var n=t.contactId;return e.formatContactId(n)},e.formatContactId=function(e){return 0===e.indexOf("+")&&(e=e.substring(1)),e=decodeURIComponent(e),$applozic.trim(e.replace(/\@/g,"AT").replace(/\./g,"DOT").replace(/\*/g,"STAR").replace(/\#/g,"HASH").replace(/\|/g,"VBAR").replace(/\+/g,"PLUS").replace(/\;/g,"SCOLON").replace(/\?/g,"QMARK").replace(/\,/g,"COMMA").replace(/\:/g,"COLON"))}}function MckMapUtils(){this.getCurrentLocation=function(e,t){w.navigator.geolocation.getCurrentPosition(e,t)},this.getSelectedLocation=function(){return{lat:MCK_CURR_LATITIUDE,lon:MCK_CURR_LONGITUDE}}}function MckDateUtils(){this.getDate=function(e){var t=new Date(parseInt(e,10)),n=new Date;return n.getDate()===t.getDate()&&n.getMonth()===t.getMonth()&&n.getYear()===t.getYear()?r(t,"h:MM TT",!1):r(t,"mmm d, h:MM TT",!1)},this.getLastSeenAtStatus=function(e){var t=new Date(parseInt(e,10)),n=new Date;if(n.getDate()===t.getDate()&&n.getMonth()===t.getMonth()&&n.getYear()===t.getYear()){var o=n.getHours()-t.getHours(),s=w.Math.floor((n.getTime()-t.getTime())/6e4);return s<60?s<=1?MCK_LABELS["last.seen"]+" 1 "+MCK_LABELS.min+" "+MCK_LABELS.ago:MCK_LABELS["last.seen"]+" "+s+MCK_LABELS.mins+" "+MCK_LABELS.ago:1===o?MCK_LABELS["last.seen"]+" 1 "+MCK_LABELS.hour+" "+MCK_LABELS.ago:MCK_LABELS["last.seen"]+" "+o+MCK_LABELS.hours+" "+MCK_LABELS.ago}return n.getDate()-t.getDate()==1&&n.getMonth()===t.getMonth()&&n.getYear()===t.getYear()?MCK_LABELS["last.seen.on"]+" "+MCK_LABELS.yesterday:MCK_LABELS["last.seen.on"]+" "+r(t,"mmm d",!1)},this.getTimeOrDate=function(e,t){var n=new Date(parseInt(e,10)),o=new Date;return t?o.getDate()===n.getDate()&&o.getMonth()===n.getMonth()&&o.getYear()===n.getYear()?r(n,"h:MM TT",!1):r(n,"mmm d",!1):r(n,"mmm d, h:MM TT",!1)},this.getSystemDate=function(e){var t=new Date(parseInt(e,10));return r(t,"mmm d, h:MM TT",!1)},this.convertMilisIntoTime=function(e){parseInt(e%1e3/100);var t=parseInt(e/1e3%60),n=parseInt(e/6e4%60),o=parseInt(e/36e5%24);return o>0?o+" Hr "+n+" Min "+t+" Sec":n>0?n+" Min "+t+" Sec":t+" Sec "};var e,t,n,o,r=(e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,t=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g,o=function(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e},function(s,i,a){var c=r;if(1!==arguments.length||"[object String]"!==Object.prototype.toString.call(s)||/\d/.test(s)||(i=s,s=void 0),s=s?new Date(s):new Date,isNaN(s))throw SyntaxError("invalid date");"UTC:"===(i=String(i)).slice(0,4)&&(i=i.slice(4),a=!0);var l=a?"getUTC":"get",u=s[l+"Date"](),d=s[l+"Day"](),p=s[l+"Month"](),f=s[l+"FullYear"](),h=s[l+"Hours"](),m=s[l+"Minutes"](),g=s[l+"Seconds"](),v=s[l+"Milliseconds"](),y=a?0:s.getTimezoneOffset(),b={d:u,dd:o(u),ddd:c.i18n.dayNames[d],dddd:c.i18n.dayNames[d+7],m:p+1,mm:o(p+1),mmm:c.i18n.monthNames[p],mmmm:c.i18n.monthNames[p+12],yy:String(f).slice(2),yyyy:f,h:h%12||12,hh:o(h%12||12),H:h,HH:o(h),M:m,MM:o(m),s:g,ss:o(g),l:o(v,3),L:o(v>99?w.Math.round(v/10):v),t:h<12?"a":"p",tt:h<12?MCK_LABELS["time.format.am"]||"am":MCK_LABELS["time.format.pm"]||"pm",T:h<12?"A":"P",TT:h<12?MCK_LABELS["time.format.AM"]||"AM":MCK_LABELS["time.format.PM"]||"PM",Z:a?"UTC":(String(s).match(t)||[""]).pop().replace(n,""),o:(y>0?"-":"+")+o(100*w.Math.floor(w.Math.abs(y)/60)+w.Math.abs(y)%60,4),S:["th","st","nd","rd"][u%10>3?0:(u%100-u%10!=10)*u%10]};return i.replace(e,function(e){return e in b?b[e]:e.slice(1,e.length-1)})});r.masks={default:"mmm d, yyyy h:MM TT",fullDateFormat:"mmm d, yyyy h:MM TT",onlyDateFormat:"mmm d",onlyTimeFormat:"h:MM TT",mailDateFormat:"mmm d, yyyy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},r.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]}}!function(e){"use strict";"undefined"==typeof Applozic?e.Applozic=function(){var e={init:function(){}};return e}():console.log("Applozic already defined.")}(window);var ALStorage=function(e){var t,n,o=[],r=[],s=[],i=[],a=new MckUtils;return{updateLatestMessage:function(e){var t=[];t.push(e),ALStorage.updateLatestMessageArray(t),ALStorage.updateMckMessageArray(t)},getLatestMessageArray:function(){return ALStorage.isSessionStorageAvailable()?$applozic.parseJSON(w.sessionStorage.getItem("mckLatestMessageArray")):o},getFriendListGroupName:function(){return ALStorage.isSessionStorageAvailable()?w.sessionStorage.getItem("friendListGroupName"):t},setFriendListGroupName:function(e){ALStorage.isSessionStorageAvailable()?w.sessionStorage.setItem("friendListGroupName",e):t=e},setFriendListGroupType:function(e){ALStorage.isSessionStorageAvailable()?w.sessionStorage.setItem("friendListGroupType",e):n=e},getFriendListGroupType:function(){return ALStorage.isSessionStorageAvailable()?w.sessionStorage.getItem("friendListGroupType"):n},setLatestMessageArray:function(e){ALStorage.isSessionStorageAvailable()?w.sessionStorage.setItem("mckLatestMessageArray",w.JSON.stringify(e)):o=e},updateLatestMessageArray:function(e){if(ALStorage.isSessionStorageAvailable()){var t=$applozic.parseJSON(w.sessionStorage.getItem("mckLatestMessageArray"));return null!==t?(t=t.concat(e),w.sessionStorage.setItem("mckLatestMessageArray",w.JSON.stringify(t))):w.sessionStorage.setItem("mckLatestMessageArray",w.JSON.stringify(e)),e}return o=o.concat(e)},getMckMessageArray:function(){return ALStorage.isSessionStorageAvailable()?$applozic.parseJSON(w.sessionStorage.getItem("mckMessageArray")):r},clearMckMessageArray:function(){ALStorage.isSessionStorageAvailable()?(w.sessionStorage.removeItem("mckMessageArray"),w.sessionStorage.removeItem("mckLatestMessageArray")):(r.length=0,o.length=0)},clearAppHeaders:function(){ALStorage.isSessionStorageAvailable()&&w.sessionStorage.removeItem("chatheaders")},setAppHeaders:function(e){if(ALStorage.isSessionStorageAvailable()){var t=a.b64EncodeUnicode(JSON.stringify(e));w.sessionStorage.setItem("chatheaders",t)}},getAppHeaders:function(){if(ALStorage.isSessionStorageAvailable()){var e=w.sessionStorage.getItem("chatheaders");return e=e?JSON.parse(a.checkIfB64Encoded(e)?a.b64DecodeUnicode(e):e):{}}},getMessageByKey:function(e){return s[e]},updateMckMessageArray:function(e){for(var t=0;t<e.length;t++){var n=e[t];s[n.key]=n}if(ALStorage.isSessionStorageAvailable()){var o=$applozic.parseJSON(w.sessionStorage.getItem("mckMessageArray"));return null!==o?(o=o.concat(e),w.sessionStorage.setItem("mckMessageArray",w.JSON.stringify(o))):w.sessionStorage.setItem("mckMessageArray",w.JSON.stringify(e)),e}return r=r.concat(e)},getMckContactNameArray:function(){return ALStorage.isSessionStorageAvailable()?$applozic.parseJSON(w.sessionStorage.getItem("mckContactNameArray")):i},setMckContactNameArray:function(e){ALStorage.isSessionStorageAvailable()?w.sessionStorage.setItem("mckContactNameArray",w.JSON.stringify(e)):i=e},updateMckContactNameArray:function(e){if(ALStorage.isSessionStorageAvailable()){var t=$applozic.parseJSON(w.sessionStorage.getItem("mckContactNameArray"));return null!==t&&(e=e.concat(t)),w.sessionStorage.setItem("mckContactNameArray",w.JSON.stringify(e)),e}return i=i.concat(e)},clearMckContactNameArray:function(){ALStorage.isSessionStorageAvailable()?w.sessionStorage.removeItem("mckContactNameArray"):i.length=0},clearSessionStorageElements:function(){ALStorage.clearMckMessageArray(),ALStorage.clearAppHeaders(),ALStorage.clearMckContactNameArray()},isSessionStorageAvailable:function(){try{return void 0!==w.sessionStorage}catch(e){return!1}}}}(window);!function(e){"use strict";"undefined"==typeof ALApiService?e.Applozic.ALApiService=function(t){var n,o,r,s,i,a,c={},l="",u=new MckUtils,d="https://apps.applozic.com";function p(e){var t="";for(var n in e)t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n])+"&";return t.substring(0,t.length-1)}return c.getFileUrl=function(){return"https://applozic.appspot.com"},c.initServerUrl=function(e){d=e},c.login=function(e){c.connect(e)},c.connect=function(e){l=e.data.alUser.applicationId,d=e.data.baseUrl?e.data.baseUrl:"https://apps.applozic.com",a=e.data.alUser.fileupload,c.ajax({url:d+"/v2/tab/initialize.page",skipEncryption:!0,type:"post",async:void 0===e.async||e.async,data:JSON.stringify(e.data.alUser),contentType:"application/json",headers:{"Application-Key":l},success:function(t){s=btoa(t.userId+":"+t.deviceKey),o=t.deviceKey,n=e.data.alUser.password,r=e.data.alUser.appModuleName,c.AUTH_TOKEN=t.authToken,c.setAjaxHeaders(s,l,t.deviceKey,e.data.alUser.password,e.data.alUser.appModuleName),c.setEncryptionKeys(t.encryptionKey,t.userEncryptionKey),e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.addRequestHeaders=function(e){c.AUTH_TOKEN?e.setRequestHeader("X-Authorization",c.AUTH_TOKEN):(s&&(e.setRequestHeader("Authorization","Basic "+s),e.setRequestHeader("Application-User","Basic "+s)),o&&e.setRequestHeader("Device-Key",o),n&&e.setRequestHeader("Access-Token",n),r&&e.setRequestHeader("App-Module-Name",r),e.setRequestHeader("UserId-Enabled",!0)),e.setRequestHeader("Application-Key",l)},c.getAttachmentHeaders=function(){var e={};return c.AUTH_TOKEN?e["X-Authorization"]=c.AUTH_TOKEN:(e={"UserId-Enabled":!0,Authorization:"Basic "+s,"Application-User":"Basic "+s,"Application-Key":l,"Device-Key":o},n&&(e["Access-Token"]=n)),e},c.getEncryptionKey=function(){return i},c.setEncryptionKeys=function(e,t){i=e},c.setAjaxHeaders=function(e,t,i,a,c){l=t,s=e,o=i,n=a,r=c},c.ajax=function(e){var t=function(){for(var e=1;e<arguments.length;e++)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&(arguments[0][t]=arguments[e][t]);return arguments[0]}({},{},e);!e.skipEncryption&&i&&("post"===t.type.toLowerCase()&&(t.data=u.encrypt(e.data,i)),t.success=function(t){var n=u.decrypt(t,i);u.isJsonString(n)?e.success(JSON.parse(n)):e.success(n)});var n,o,r=new XMLHttpRequest,s=!0;(void 0!==t.async||e.async)&&(s=t.async);var a=t.type.toUpperCase();"GET"===a&&void 0!==t.data&&(t.url=t.url+"?"+t.data),r.open(a,t.url,s),"POST"!==a&&"GET"!==a||(o=void 0===t.contentType?"application/x-www-form-urlencoded; charset=UTF-8":t.contentType,r.setRequestHeader("Content-Type",o)),d=d||"https://apps.applozic.com",-1!==t.url.indexOf(d)&&c.addRequestHeaders(r),-1!==t.url.indexOf("applozic.appspot.com")&&r.setRequestHeader("Application-Key",l),void 0===t.data?r.send():r.send(t.data),r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status){var e=r.getResponseHeader("Content-Type");void 0!==e&&"null"!==e&&null!==e||(e=""),n=-1!=e.toLowerCase().indexOf("text/html")?r.responseXML:-1!=e.toLowerCase().indexOf("application/json")?JSON.parse(r.responseText):r.responseText,t.success(n)}else t.error(n)}},c.getMessages=function(e){e.data.userId||e.data.groupId?"undefined"===e.data.pageSize&&(e.data.pageSize=30):void 0===e.data.mainPageSize&&(e.data.mainPageSize=60);var t=p(e.data),n=new Object;c.ajax({url:d+"/rest/ws/message/list?"+t,async:void 0===e.async||e.async,type:"get",success:function(t){n.status="success",n.data=t,e.success&&e.success(n)},error:function(t,o,r){n.status="error",e.error&&e.error(n)}})},c.sendMessage=function(e){c.ajax({type:"POST",url:d+"/rest/ws/message/send",global:!1,data:JSON.stringify(e.data.message),async:void 0===e.async||e.async,contentType:"application/json",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.sendDeliveryUpdate=function(e){c.ajax({url:d+"/rest/ws/message/delivered",data:"key="+e.data.key,global:!1,type:"get",async:void 0===e.async||e.async,success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.sendReadUpdate=function(e){c.ajax({url:d+"/rest/ws/message/read",data:"key="+e.data.key,global:!1,type:"get",async:void 0===e.async||e.async,success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.deleteMessage=function(e){c.ajax({url:d+"/rest/ws/message/delete?key="+e.data.key,global:!1,type:"get",async:void 0===e.async||e.async,success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.updateReplyMessage=function(e){c.ajax({url:d+"/rest/ws/message/detail?keys="+e.data.key,type:"get",async:void 0===e.async||e.async,success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.deleteConversation=function(e){c.ajax({url:d+"/rest/ws/message/delete/conversation",type:"get",async:void 0===e.async||e.async,global:!1,data:p(e.data),success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.createGroup=function(e){c.ajax({url:d+"/rest/ws/group/create",global:!1,data:JSON.stringify(e.data.group),type:"post",async:void 0===e.async||e.async,contentType:"application/json",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.loadGroups=function(e){e.baseUrl&&(d=e.baseUrl),c.ajax({url:d+"/rest/ws/group/list",type:"get",async:void 0===e.async||e.async,global:!1,success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.getGroupInfo=function(e){var t=e.data.groupId?"?groupId="+e.data.groupId:"?clientGroupId="+e.data.clientGroupId;c.ajax({url:d+"/rest/ws/group/v2/info"+t,type:"get",async:void 0===e.async||e.async,global:!1,success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.addGroupMember=function(e){c.ajax({url:d+"/rest/ws/group/add/member",type:"POST",data:JSON.stringify(e.data.group),async:void 0===e.async||e.async,global:!1,contentType:"application/json",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.removeGroupMember=function(e){c.ajax({url:d+"/rest/ws/group/remove/member",type:"POST",data:JSON.stringify(e.data),async:void 0===e.async||e.async,global:!1,contentType:"application/json",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.groupLeave=function(e){c.ajax({url:d+"/rest/ws/group/left",type:"POST",data:JSON.stringify(e.data),async:void 0===e.async||e.async,global:!1,contentType:"application/json",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.groupUpdate=function(e){c.ajax({url:d+"/rest/ws/group/update",type:"POST",data:JSON.stringify(e.data),async:void 0===e.async||e.async,global:!1,contentType:"application/json",success:function(t){e.success&&e.success(t,e.data)},error:function(t){e.error&&e.error(t)}})},c.isUserPresentInGroup=function(e){c.ajax({url:d+"/rest/ws/group/check/user?userId="+e.data.userId+"&clientGroupId="+e.data.clientGroupId,type:"get",async:void 0===e.async||e.async,global:!1,success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.groupUserCount=function(e){c.ajax({url:d+"/rest/ws/group/user/count?clientGroupIds="+e.data.clientGroupId,type:"get",async:void 0===e.async||e.async,global:!1,success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.groupDelete=function(e){c.ajax({url:d+"/rest/ws/group/left?clientGroupId="+e.data.clientGroupId,type:"GET",async:void 0===e.async||e.async,global:!1,success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.createUserFriendList=function(e){c.ajax({url:d+"/rest/ws/group/"+e.data.group.groupName+"/add/",type:"POST",async:void 0===e.async||e.async,global:!1,data:JSON.stringify(e.data.group.groupMemberList),contentType:"application/json",success:function(t){e.success&&(e.success(t),ALStorage.setFriendListGroupName(e.data.group.groupName))},error:function(t){e.error&&e.error(t)}})},c.createOpenFriendList=function(e){c.ajax({url:d+"/rest/ws/group/"+e.data.group.groupName+"/add/members",type:"POST",data:JSON.stringify(e.data.group),async:void 0===e.async||e.async,global:!1,contentType:"application/json",success:function(t){e.success&&(e.success(t),ALStorage.setFriendListGroupName(e.data.group.groupName),ALStorage.setFriendListGroupType(e.data.group.type))},error:function(t){e.error&&e.error(t)}})},c.getFriendList=function(e){var t="null"!==e.data.type?"/get?groupType=9":"/get";e.data.url=e.data.url?e.data.url:t,c.ajax({url:d+"/rest/ws/group/"+e.data.groupName+e.data.url,type:"GET",async:void 0===e.data.async||e.data.async,global:!1,contentType:"application/json",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.removeUserFromFriendList=function(e){var t=e.group.type?"/remove?userId="+e.group.userId+"&groupType=9":"/remove?userId="+e.group.userId;c.ajax({url:d+"/rest/ws/group/"+e.group.groupName+t,type:"Post",contentType:"application/json",async:void 0===e.async||e.async,global:!1,success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.deleteFriendList=function(e){var t=e.group.type?"/delete?groupType=9":"/delete";c.ajax({url:d+"/rest/ws/group/"+e.group.groupName+t,type:"GET",async:!1,contentType:"application/json",async:void 0===e.async||e.async,success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.getUserDetail=function(e){c.ajax({url:d+"/rest/ws/user/v2/detail",data:JSON.stringify({userIdList:e.data}),type:"POST",async:void 0===e.async||e.async,global:!1,contentType:"application/json",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.updateUserDetail=function(e){c.ajax({url:d+"/rest/ws/user/update",data:JSON.stringify(e.data),type:"POST",async:void 0===e.async||e.async,global:!1,contentType:"application/json",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.updatePassword=function(e){c.ajax({url:d+"/rest/ws/user/update/password?oldPassword="+e.data.oldPassword+"&newPassword="+e.data.newPassword,type:"GET",async:void 0===e.async||e.async,global:!1,success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.getContactList=function(e){var t=e.baseUrl?e.baseUrl:d;c.ajax({url:t+e.url,type:"GET",async:void 0===e.async||e.async,global:!1,success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.userChatMute=function(e){c.ajax({url:d+"/rest/ws/user/chat/mute?userId="+e.data.userId+"&notificationAfterTime="+e.data.notificationAfterTime,type:"post",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.groupMute=function(e){var t={};t.clientGroupId=e.data.clientGroupId,t.notificationAfterTime=e.data.notificationAfterTime,c.ajax({url:d+"/rest/ws/group/user/update",type:"post",data:JSON.stringify(t),contentType:"application/json",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.syncMuteUserList=function(e){c.ajax({url:d+"/rest/ws/user/chat/mute/list",type:"get",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.blockUser=function(e){c.ajax({url:d+"/rest/ws/user/block?userId="+e.data.userId+"&block="+e.data.isBlock,type:"GET",async:void 0===e.async||e.async,global:!1,success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.unBlockUser=function(e){c.ajax({url:d+"/rest/ws/user/unblock?userId="+e.data.userId,type:"GET",async:void 0===e.async||e.async,global:!1,success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.sendConversationCloseUpdate=function(e){var t="id="+e.conversationId;c.ajax({url:d+"/rest/ws/conversation/close",data:t,global:!1,type:"get",success:function(){},error:function(){}})},c.fileUpload=function(e){c.ajax({type:"GET",skipEncryption:!0,url:e.data.url,global:!1,data:"data="+(new Date).getTime(),crosDomain:!0,success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.sendAttachment=function(t){"awsS3Server"===a?e.Applozic.ALApiService.sendAttachmentToAWS(t):"googleCloud"===a?e.Applozic.ALApiService.sendAttachmentToCloud(t):e.Applozic.ALApiService.sendAttachmentToGoogleServer(t)},c.sendAttachmentToGoogleServer=function(e){var t=new XMLHttpRequest;c.ajax({type:"GET",skipEncryption:!0,url:void 0!==e.url?e.url:"https://applozic.appspot.com/rest/ws/aws/file/url",global:!1,data:"data="+(new Date).getTime(),crosDomain:!0,success:function(n){t.addEventListener("load",function(t){var n=JSON.parse(this.responseText),o=e.data.messagePxy;n&&(o.fileMeta=n.fileMeta,Applozic.ALApiService.sendMessage({data:{message:o},success:function(e){console.log(e)},error:function(){}}))});var o=new FormData,r=e.data.file;o.append("files[]",r),t.open("POST",n,!0),c.addRequestHeaders(t),t.send(o)},error:function(t){e.error&&e.error(t)}})},c.sendAttachmentToAWS=function(e){var t=new FormData,n=new XMLHttpRequest,o=d+"/rest/ws/upload/image";n.addEventListener("load",function(t){var n=this.responseText,o=e.data.messagePxy;n&&(o.fileMeta=JSON.parse(n),Applozic.ALApiService.sendMessage({data:{message:o},success:function(e){console.log(e)},error:function(){}}))}),t.append("file",e.data.file),n.open("post",o,!0),c.addRequestHeaders(n),n.send(t)},c.sendAttachmentToCloud=function(e){var t=new FormData,n=new XMLHttpRequest,o=void 0!==e.cloudUploadUrl?e.cloudUploadUrl:"https://googleupload.applozic.com/files/upload/";n.addEventListener("load",function(t){var n=JSON.parse(this.responseText),o=e.data.messagePxy;n&&(o.fileMeta=n.fileMeta,Applozic.ALApiService.sendMessage({data:{message:o},success:function(e){console.log(e)},error:function(){}}))}),t.append("files[]",e.data.file),n.open("post",o,!0),c.addRequestHeaders(n),n.send(t)},c.deleteFileMeta=function(e){c.ajax({url:e.data.url,skipEncryption:!0,type:"post",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.addMessageInbox=function(e){c.ajax({type:"GET",url:d+"/rest/ws/message/add/inbox",global:!1,data:"sender="+encodeURIComponent(e.data.sender)+"&messageContent="+encodeURIComponent(e.data.messageContent),contentType:"text/plain",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.conversationReadUpdate=function(e){c.ajax({url:d+"/rest/ws/message/read/conversation",data:e.data,global:!1,type:"get",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.success(t)}})},c.sendSubscriptionIdToServer=function(e){var t=e.data.subscriptionId;c.ajax({url:d+"/rest/ws/plugin/update/sw/id",skipEncryption:!0,type:"post",data:"registrationId="+t,success:function(e){},error:function(e,t,n){401===e.status&&(ALStorage.clearSessionStorageElements(),console.log("Please reload page."))}})},c.getTopicId=function(e){var t="id="+e.data.conversationId;c.ajax({url:d+"/rest/ws/conversation/topicId?"+t,type:"get",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.success(t)}})},c.getContactDisplayName=function(e){var t=e.data.userIdArray;if(t.length>0&&t[0]){for(var n="",o=t.filter(function(e,n){return t.indexOf(e)===n}),r=0;r<o.length;r++){var s=o[r];void 0===MCK_CONTACT_NAME_MAP[s]&&(n+="userIds="+encodeURIComponent(s)+"&")}n.lastIndexOf("&")===n.length-1&&(n=n.substring(0,n.length-1)),n&&c.ajax({url:d+"/rest/ws/user/info",data:n,global:!1,type:"get",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.success(t)}})}},c.getUserStatus=function(e){c.ajax({url:d+"/rest/ws/user/chat/status",type:"get",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.success(t)}})},c.fetchConversationByTopicId=function(e){var t="topic="+e.data.topicId;if(e.data.tabId)t+=""+e.data.isGroup=="true"?"&groupId="+e.data.tabId:"&userId="+encodeURIComponent(e.data.tabId);else{if(!e.data.clientGroupId)return!1;t+="&clientGroupId="+e.data.clientGroupId}e.data.pageSize&&(t+="&pageSize="+e.data.pageSize),c.ajax({url:d+"/rest/ws/conversation/get",data:t,type:"get",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.success(t)}})},c.getConversationId=function(e){c.ajax({url:d+"/rest/ws/conversation/id",global:!1,data:w.JSON.stringify(e.data),type:"post",contentType:"application/json",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.success(t)}})},c.registerClientApi=function(e){c.ajax({url:d+"/rest/ws/register/client",type:"post",data:JSON.stringify(e.data.userPxy),contentType:"application/json",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.success(t)}})},c.logout=function(e){c.ajax({url:d+"/rest/ws/device/logout",type:"post",async:void 0===e.async||e.async,contentType:"application/json",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c.getUsersByRole=function(e){var t=p(e.data);c.ajax({url:d+"/rest/ws/user/v3/filter?"+t,global:!1,type:"get",contentType:"application/json",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.success(t)}})},c.pushNotificationLogout=function(e){c.ajax({url:d+"/rest/ws/device/logout",type:"post",async:void 0===e.async||e.async,contentType:"application/json",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},c}():console.log("ALApiService already defined.")}(window),function(e){"use strict";"undefined"==typeof ALSocket?e.Applozic.ALSocket=function(){var t,n={events:{}},o=null;n.stompClient=null;var r,s,i="";n.typingSubscriber=null,n.openGroupSubscriber=[];var a=[];n.mck_typing_status=0;var c="",l="https://socket.applozic.com",u="80";n.MCK_TOKEN,n.USER_DEVICE_KEY,n.USER_ENCRYPTION_KEY;var d=new MckUtils;return n.init=function(o,r,s){o&&(t=o),void 0!==r&&(n.MCK_TOKEN=r.token,n.USER_DEVICE_KEY=r.deviceKey,r.encryptionKey&&(n.USER_ENCRYPTION_KEY=r.userEncryptionKey),l=r.websocketUrl,u=void 0===r.websocketPort?d.startsWith(l,"https")?"15675":"15674":r.websocketPort),n.events=s,void 0!==l&&navigator.onLine&&"function"==typeof SockJS&&(c=new SockJS(l+":"+u+"/stomp"),n.stompClient=Stomp.over(c),n.stompClient.heartbeat.outgoing=0,n.stompClient.heartbeat.incoming=0,n.stompClient.reconnect_delay=3e4,n.stompClient.debug=null,n.stompClient.onclose=function(){n.disconnect()},n.stompClient.connect("guest","guest",n.onConnect,n.onError,"/"),e.addEventListener("beforeunload",function(e){var t;e.target.activeElement&&(t=e.target.activeElement.href),t&&0!==t.length||n.disconnect()}))},n.checkConnected=function(e){n.stompClient.connected?(r&&clearInterval(r),s&&clearInterval(s),r=setInterval(function(){n.connectToSocket(e)},6e5),s=setInterval(function(){n.sendStatus(1)},12e5)):n.connectToSocket(e)},n.connectToSocket=function(e){"function"==typeof n.connectToSocket&&n.events.connectToSocket(e)},n.stopConnectedCheck=function(){r&&clearInterval(r),s&&clearInterval(s),r="",s="",n.disconnect()},n.disconnect=function(){n.stompClient&&n.stompClient.connected&&(n.sendStatus(0),n.stompClient.disconnect(),"object"==typeof c&&(c.close(),c=""))},n.unsubscibeToTypingChannel=function(){n.stompClient&&n.stompClient.connected&&n.typingSubscriber&&(1===n.mck_typing_status&&n.sendTypingStatus(0,i),n.typingSubscriber.unsubscribe()),n.typingSubscriber=null},n.unsubscibeToNotification=function(){n.stompClient&&n.stompClient.connected&&o&&o.unsubscribe(),o=null},n.subscibeToTypingChannel=function(e){n.stompClient&&n.stompClient.connected?n.typingSubscriber=n.stompClient.subscribe("/topic/typing-"+t+"-"+e,n.onTypingStatus):n.reconnect()},n.subscribeToOpenGroup=function(e){if(console.log("adding subscription"),n.stompClient&&n.stompClient.connected){var o=n.stompClient.subscribe("/topic/group-"+t+"-"+e.contactId,n.onOpenGroupMessage);n.openGroupSubscriber.push(o.id),a[e.contactId]=o.id}else n.reconnect()},n.sendTypingStatus=function(e,o,r,s){if(n.mck_typing_status=o,n.stompClient&&n.stompClient.connected){if(1===e&&1===n.mck_typing_status&&n.stompClient.send("/topic/typing-"+t+"-"+i,{"content-type":"text/plain"},t+","+r+","+e),s){if(s===i&&e===n.mck_typing_status&&1===e)return;i=s,n.stompClient.send("/topic/typing-"+t+"-"+s,{"content-type":"text/plain"},t+","+r+","+e),setTimeout(function(){n.mck_typing_status=0},6e4)}else 0===e&&n.stompClient.send("/topic/typing-"+t+"-"+i,{"content-type":"text/plain"},t+","+r+","+e);n.mck_typing_status=e}},n.onTypingStatus=function(e){"function"==typeof n.events.onTypingStatus&&n.events.onTypingStatus(e)},n.reconnect=function(){n.unsubscibeToTypingChannel(),n.unsubscibeToNotification(),n.disconnect();var e={};e.token=n.MCK_TOKEN,e.deviceKey=n.USER_DEVICE_KEY,e.userEncryptionKey=n.USER_ENCRYPTION_KEY,e.websocketUrl=l,e.websocketPort=u,n.init(t,e,n.events)},n.onError=function(e){console.log("Error in channel notification. "+e),"function"==typeof n.events.onConnectFailed&&setTimeout(function(){n.events.onConnectFailed()},3e4)},n.sendStatus=function(e){n.stompClient&&n.stompClient.connected&&n.stompClient.send("/topic/status-v2",{"content-type":"text/plain"},n.MCK_TOKEN+","+n.USER_DEVICE_KEY+","+e)},n.sendMessageStatus=function(e,t,o){n.stompClient&&n.stompClient.connected&&n.stompClient.send("/topic/message-status",{"content-type":"text/plain"},o+","+e+","+t)},n.onConnect=function(){var e="/topic/"+(n.USER_ENCRYPTION_KEY?"encr-":"")+n.MCK_TOKEN;n.stompClient.connected?(o&&n.unsubscibeToNotification(),o=n.stompClient.subscribe(e,n.onMessage),n.sendStatus(1),n.checkConnected(!0)):setTimeout(function(){o=n.stompClient.subscribe(e,n.onMessage),n.sendStatus(1),n.checkConnected(!0)},5e3),"function"==typeof n.events.onConnect&&n.events.onConnect()},n.onOpenGroupMessage=function(e){"function"==typeof n.events.onOpenGroupMessage&&n.events.onOpenGroupMessage(e)},n.onMessage=function(e){if(null!=o&&o.id===e.headers.subscription){var t=d.decrypt(e.body,n.USER_ENCRYPTION_KEY),r=JSON.parse(t),s=r.type;if("function"==typeof n.events.onMessage&&n.events.onMessage(r),"APPLOZIC_04"===s||"MESSAGE_DELIVERED"===s)n.events.onMessageDelivered(r);else if("APPLOZIC_08"===s||"MT_MESSAGE_DELIVERED_READ"===s)n.events.onMessageRead(r);else if("APPLOZIC_05"===s)n.events.onMessageDeleted(r);else if("APPLOZIC_27"===s)n.events.onConversationDeleted(r);else if("APPLOZIC_11"===s)n.events.onUserConnect(r.message);else if("APPLOZIC_12"===s){var i=r.message.split(",")[1];n.events.onUserDisconnect({userId:c,lastSeenAtTime:i})}else if("APPLOZIC_29"===s)n.events.onConversationReadFromOtherSource(r);else if("APPLOZIC_28"===s)n.events.onConversationRead(r);else if("APPLOZIC_16"===s){var a=r.message.split(":")[0],c=r.message.split(":")[1];n.events.onUserBlocked({status:a,userId:c})}else if("APPLOZIC_17"===s)a=r.message.split(":")[0],c=r.message.split(":")[1],n.events.onUserUnblocked({status:a,userId:c});else if("APPLOZIC_18"===s)n.events.onUserActivated();else if("APPLOZIC_19"===s)n.events.onUserDeactivated();else{var l=r.message;if("APPLOZIC_03"===s)n.events.onMessageSentUpdate({messageKey:l.key});else if("APPLOZIC_01"===s||"MESSAGE_RECEIVED"===s){var u=alMessageService.getMessageFeed(l);n.events.onMessageReceived({message:u})}else"APPLOZIC_02"===s&&(u=alMessageService.getMessageFeed(l),n.events.onMessageSent({message:u}))}}},n}():console.log("ALSocket already defined.")}(window);var mckNotificationUtils=new MckNotificationUtils,alNotificationService=new AlNotificationService;function AlNotificationService(){var e,t,n=this;n.init=function(t){e="boolean"==typeof t.swNotification&&t.swNotification,t.contactDisplayImage,t.notificationIconLink,"boolean"==typeof t.desktopNotification&&t.desktopNotification},n.unsubscribeToServiceWorker=function(){t&&navigator.serviceWorker.ready.then(function(e){t.unsubscribe().then(function(e){t=null,console.log("Unsubscribed to notification successfully")})})},n.sendSubscriptionIdToServer=function(){if(t){var e=t.endpoint.split("/").slice(-1)[0];e&&window.Applozic.ALApiService.sendSubscriptionIdToServer({data:{subscriptionId:e},success:function(e){},error:function(){}})}},n.subscribeToServiceWorker=function(){e&&"serviceWorker"in navigator&&(navigator.serviceWorker.register("./service-worker.js",{scope:"./"}),navigator.serviceWorker.ready.then(function(e){e.pushManager.subscribe({userVisibleOnly:!0}).then(function(e){console.log("The reg ID is:: ",e.endpoint.split("/").slice(-1)),t=e,n.sendSubscriptionIdToServer()})}))}}function MckNotificationUtils(){var e=this,t=window.top,n=["granted","default","denied"],o=function(){var e=!1;try{e=!!(t.Notification||t.webkitNotifications||navigator.mozNotification||t.external&&void 0!==t.external.msIsSiteMode())}catch(e){}return e}(),r=Math.floor(10*Math.random()+1),s=function(){};e.permissionLevel=function(){var e;if(o)return t.Notification&&t.Notification.permissionLevel?e=t.Notification.permissionLevel():t.webkitNotifications&&t.webkitNotifications.checkPermission?e=n[t.webkitNotifications.checkPermission()]:t.Notification&&t.Notification.permission?e=t.Notification.permission:navigator.mozNotification?e="granted":t.external&&void 0!==t.external.msIsSiteMode()&&(e=t.external.msIsSiteMode()?"granted":"default"),e},e.requestPermission=function(e){var n,o=(n=e)&&n.constructor===Function?e:s;t.webkitNotifications&&t.webkitNotifications.checkPermission?t.webkitNotifications.requestPermission(o):t.Notification&&t.Notification.requestPermission&&t.Notification.requestPermission(o)},e.isChrome=function(){return/chrom(e|ium)/.test(t.navigator.userAgent.toLowerCase())},e.getNotification=function(n,o,s,i){var a;if(i&&(i.play(),setTimeout(function(){i.stop()},1e3)),t.Notification){var c={icon:o,body:s};(a=new t.Notification(n,c)).onclick=function(){t.focus(),this.close()}}else t.webkitNotifications?(a=t.webkitNotifications.createNotification(o,n,s),i&&a.show(),e.isChrome()&&(a.onclick=function(){t.focus(),this.cancel()}),a.show(),setTimeout(function(){a.cancel()},3e4)):navigator.mozNotification?(a=navigator.mozNotification.createNotification(n,s,o)).show():t.external&&t.external.msIsSiteMode()&&(t.external.msSiteModeClearIconOverlay(),t.external.msSiteModeSetIconOverlay(o,n),t.external.msSiteModeActivate(),a={ieVerification:r+1});return a},e.sendDesktopNotification=function(n,o,r,s){if("granted"!==e.permissionLevel()&&t.Notification.requestPermission(),"granted"===e.permissionLevel()){var i;i=s?e.getNotification(n,o,r,s):e.getNotification(n,o,r);var a=e.getWrapper(i);i&&!i.ieVerification&&i.addEventListener&&i.addEventListener("show",function(){var e=a;t.setTimeout(function(){e.close()},3e4)})}},e.getWrapper=function(e){return{close:function(){e&&(e.close?e.close():e.cancel?e.cancel():t.external&&t.external.msIsSiteMode()&&e.ieVerification===r&&t.external.msSiteModeClearIconOverlay())}}}}var mckGroupUtils=new MckGroupUtils,mckGroupService=new MckGroupService;function MckGroupUtils(){this.getGroup=function(e){return"object"==typeof MCK_GROUP_MAP[e]?MCK_GROUP_MAP[e]:void 0},this.getGroupByClientGroupId=function(e){return"object"==typeof MCK_CLIENT_GROUP_MAP[e]?MCK_CLIENT_GROUP_MAP[e]:void 0},this.addGroup=function(e){var t=e.name?e.name:e.id,n=[];$applozic.each(e.groupUsers,function(e,t){t.userId&&(n[t.userId]=t)});var o=void 0!==e.removedMembersId?e.removedMembersId:[],r={contactId:e.id.toString(),htmlId:mckContactUtils.formatContactId(""+e.id),displayName:t,value:e.id.toString(),adminName:e.adminId?e.adminId:e.adminName,type:e.type,members:e.membersId?e.membersId:e.membersName,imageUrl:e.imageUrl,users:n,userCount:e.userCount,removedMembersId:o,clientGroupId:e.clientGroupId,isGroup:!0,deletedAtTime:e.deletedAtTime,metadata:e.metadata};return MCK_GROUP_MAP[e.id]=r,e.clientGroupId&&(MCK_CLIENT_GROUP_MAP[e.clientGroupId]=r),r},this.createGroup=function(e){var t={contactId:e.toString(),htmlId:mckContactUtils.formatContactId(""+e),displayName:e.toString(),value:e.toString(),type:2,adminName:"",imageUrl:"",userCount:"",users:[],removedMembersId:[],clientGroupId:"",isGroup:!0,deletedAtTime:""};return MCK_GROUP_MAP[e]=t,t}}function MckGroupService(){var e,t,n,o=this;MCK_GROUP_ARRAY=new Array,o.init=function(o){e=o.visitor,t=e?"guest":$applozic.trim(o.userId),n=o.openGroupSettings},o.loadGroups=function(e){var t=new Object;window.Applozic.ALApiService.loadGroups({baseUrl:MCK_BASE_URL,success:function(n){"success"===n.status?(t.status="success",t.data=n.response,e.apzCallback&&e.apzCallback(t)):t.status="error",e.callback&&e.callback(t)},error:function(){console.log("Unable to load groups. Please reload page."),t.status="error",e.callback&&e.callback(t),e.apzCallback&&e.apzCallback(t)}})},o.getGroupFeed=function(e){var t={};if("function"==typeof e.callback||"function"==typeof e.apzCallback){var n=new Object;if(e.groupId)t.groupId=e.groupId;else{if(!e.clientGroupId)return void("function"==typeof e.callback&&(n.status="error",n.errorMessage="GroupId or Client GroupId Required",e.callback(n)));t.clientGroupId=e.clientGroupId}e.conversationId&&(t.conversationId=e.conversationId),Applozic.ALApiService.getGroupInfo({data:t,success:function(t){if("success"===t.status){var n=t.response;if(n+""=="null"||"object"!=typeof n)t.status="error",t.errorMessage="GroupId not found";else{var o=mckGroupUtils.addGroup(n);t.status="success",t.data=o}}else"error"===t.status&&(t.status="error",t.errorMessage=t.errorResponse[0].description);e.callback&&e.callback(t),e.apzCallback&&("success"===t.status&&(t.data=n),e.apzCallback(t,e))},error:function(){console.log("Unable to load group. Please reload page."),n.status="error",n.errorMessage="Please reload page.",e.callback&&e.callback(n),e.apzCallback&&e.apzCallback(n,e)}})}},o.leaveGroup=function(e){var t={},n=new Object;if(e.groupId)t.groupId=e.groupId;else{if(!e.clientGroupId)return n.status="error",n.errorMessage="GroupId or Client GroupId Required",void(e.callback&&e.callback(n));t.clientGroupId=e.clientGroupId}Applozic.ALApiService.groupLeave({data:t,success:function(t){if("success"===t.status){if(e.clientGroupId){var o=mckGroupUtils.getGroupByClientGroupId(e.clientGroupId);"object"==typeof o&&(e.groupInfo=o.contactId)}n.status="success",n.data={groupId:e.groupId}}else n.status="error",n.errorMessage=t.errorResponse[0].description;e.callback&&e.callback(n),e.apzCallback&&e.apzCallback(n,{groupId:e.groupId})},error:function(){console.log("Unable to process your request. Please reload page."),n.status="error",n.errorMessage="",e.callback&&e.callback(n),e.apzCallback&&e.apzCallback(n)}})},o.removeGroupMemberFromChat=function(e){var t={},n=new Object;if(e.groupId)t.groupId=e.groupId;else{if(!e.clientGroupId)return n.status="error",n.errorMessage="GroupId or Client GroupId Required",void("function"==typeof e.callback&&e.callback(n));t.clientGroupId=e.clientGroupId}t.userId=e.userId,Applozic.ALApiService.removeGroupMember({data:t,success:function(t){if("success"===t.status){if(e.clientGroupId){var n=mckGroupUtils.getGroupByClientGroupId(e.clientGroupId);"object"==typeof n&&(e.groupId=n.contactId)}t.status="success"}else t.status="error",t.errorMessage=data.errorResponse[0].description;e.callback&&e.callback(t),e.apzCallback&&e.apzCallback(t,e)},error:function(){console.log("Unable to process your request. Please reload page."),n.status="error",n.errorMessage="",e.callback&&e.callback(n),e.apzCallback&&e.apzCallback(n),e.apzCallback(n)}})},o.addGroupMember=function(e){var t={},n=new Object;if(e.groupId)t.groupId=e.groupId;else{if(!e.clientGroupId)return void("function"==typeof e.callback&&e.callback(n));t.clientGroupId=e.clientGroupId}t.userId=e.userId,void 0!==e.role&&(t.role=e.role),Applozic.ALApiService.addGroupMember({data:{group:t},success:function(t){if("success"===t.status){if(e.clientGroupId){var o=mckGroupUtils.getGroupByClientGroupId(e.clientGroupId);"object"==typeof o&&(e.groupId=o.contactId)}n.status="success",n.data=t.response}else n.status="error",n.errorMessage=t.errorResponse[0].description;e.callback&&e.callback(n),e.apzCallback&&e.apzCallback(n,e)},error:function(){console.log("Unable to process your request. Please reload page."),n.status="error",n.errorMessage="",e.callback&&e.callback(n),e.apzCallback&&e.apzCallback(n)}})},o.updateGroupInfo=function(e){var t={},n=new Object;if(e.groupId)t.groupId=e.groupId;else{if(!e.clientGroupId)return void("function"==typeof e.callback&&(n.status="error",n.errorMessage="GroupId or Client GroupId Required",e.callback(n)));t.clientGroupId=e.clientGroupId}e.name&&(t.newName=e.name),e.imageUrl&&(t.imageUrl=e.imageUrl),e.users&&e.users.length>0&&(t.users=e.users),Applozic.ALApiService.groupUpdate({data:t,success:function(t,o){if("success"===t.status){if(e.clientGroupId)"object"==typeof(o=mckGroupLayout.getGroupByClientGroupId(e.clientGroupId))&&(e.groupId=o.contactId);n.status="success",n.data=t.response}else n.status="error",n.errorMessage=t.errorResponse[0].description;e.callback&&e.callback(n),e.apzCallback&&e.apzCallback(n,{groupId:e.groupId,groupInfo:o,users:e.users})},error:function(){console.log("Unable to process your request. Please reload page."),n.status="error",n.errorMessage="Unable to process your request. Please reload page.",e.callback&&e.callback(n),e.apzCallback&&e.apzCallback(n)}})},o.sendGroupMessage=function(e){if("object"==typeof e){var t=(e=$applozic.extend(!0,{},message_default_options,e)).message;if(!e.groupId&&!e.clientGroupId)return"groupId or clientGroupId required";if(void 0===t||""===t)return"message field required";if(e.type>12)return"invalid message type";t=$applozic.trim(t);var n={type:e.messageType,contentType:e.type,message:t};if(e.groupId)n.groupId=$applozic.trim(e.groupId);else if(e.clientGroupId){if(void 0===mckGroupUtils.getGroupByClientGroupId(e.clientGroupId))return"group not found";n.clientGroupId=$applozic.trim(e.clientGroupId)}return mckMessageService.sendMessage(n),"success"}return"Unsupported format. Please check format"},o.getContactFromGroupOfTwo=function(e,n){for(var o,r=0;r<e.members.length;r++)if(o=""+e.members[r],t!==o)return"function"==typeof n&&n(o),o},o.addGroupFromMessage=function(e,t,n){var o=e.groupId,r=mckGroupUtils.getGroup(""+o);void 0===r&&(r=mckGroupUtils.createGroup(o),mckGroupService.loadGroups({apzCallback:mckGroupLayout.loadGroups})),"function"==typeof n&&n(r,e,t)},o.isGroupDeleted=function(e,t){if(t){var n=mckGroupLayout.getDeletedAtTime(e);return void 0!==n&&n>0}return!1},o.loadGroupsCallback=function(e){var t=e.data;MCK_GROUP_ARRAY.length=0,$applozic.each(t,function(e,t){if(void 0!==t.id){t=mckGroupUtils.addGroup(t);MCK_GROUP_ARRAY.push(t)}})},o.getGroupDisplayName=function(e){if("object"==typeof MCK_GROUP_MAP[e]){var n=MCK_GROUP_MAP[e],r=n.displayName,s=[];if(7===n.type){var i=o.getContactFromGroupOfTwo(n);void 0!==i&&(alUserService.MCK_USER_DETAIL_MAP[i]?alUserService.MCK_USER_DETAIL_MAP[i]&&alUserService.MCK_USER_DETAIL_MAP[i].displayName&&(r=alUserService.MCK_USER_DETAIL_MAP[i].displayName):(s.push(i),window.Applozic.ALApiService.getUserDetail({data:s,success:function(e){e.response.length>0&&$applozic.each(e.response,function(e,t){alUserService.MCK_USER_DETAIL_MAP[t.userId]=t,alUserService.MCK_USER_DETAIL_MAP[i]&&alUserService.MCK_USER_DETAIL_MAP[i].displayName&&(r=alUserService.MCK_USER_DETAIL_MAP[i].displayName)})}})))}if(3===n.type&&-1!==r.indexOf(t)&&(r=r.replace(t,"").replace(":",""),"function"==typeof MCK_GETUSERNAME)){var a=MCK_GETUSERNAME(r);r=a||r}return r||5!==n.type||(r="Broadcast"),r||(r=n.contactId),r}return e},o.getGroupImage=function(e){return e?'<img src="'+e+'"/>':'<img src="'+MCK_BASE_URL+'/resources/sidebox/css/app/images/mck-icon-group.png"/>'},o.getGroupDefaultIcon=function(){return'<div class="mck-group-icon-default"></div>'},o.addMemberToGroup=function(e,t){return"object"==typeof e.members&&(-1===e.members.indexOf(t)&&e.members.push(t),"object"==typeof e.removedMembersId&&-1!==e.removedMembersId.indexOf(t)&&e.removedMembersId.splice(e.removedMembersId.indexOf(t),1),MCK_GROUP_MAP[e.contactId]=e),e},o.removeMemberFromGroup=function(e,t){return"object"!=typeof e.removedMembersId||e.removedMembersId.length<1?(e.removedMembersId=[],e.removedMembersId.push(t)):-1===e.removedMembersId.indexOf(t)&&e.removedMembersId.push(t),MCK_GROUP_MAP[e.contactId]=e,e},o.authenticateGroupUser=function(e){var n=!1;if(!mckGroupService.isGroupLeft(e)&&e.members.length>0)for(var o=0;o<e.members.length;o++)if(t===""+e.members[o])return n=!0,!0;return n},o.isAppendOpenGroupContextMenu=function(e){return 0!==n.deleteChatAccess&&(!!mckGroupService.authenticateGroupUser(e)&&(e.adminName===t||2===n.deleteChatAccess))},o.isGroupLeft=function(e){var n=!1;return e.removedMembersId&&e.removedMembersId.length>0&&$applozic.each(e.removedMembersId,function(e,o){o===t&&(n=!0)}),n}}var alUserService=new AlUserService;function AlUserService(){var e=this;e.MCK_USER_DETAIL_MAP=[],e.MCK_BLOCKED_TO_MAP=[];new Array;e.updateUserStatus=function(e,t){if("object"==typeof alUserService.MCK_USER_DETAIL_MAP[e.userId]){var n=alUserService.MCK_USER_DETAIL_MAP[e.userId];0===e.status?(n.connected=!1,n.lastSeenAtTime=e.lastSeenAtTime):1===e.status&&(n.connected=!0)}else{var o=new Array;o.push(e.userId),"function"==typeof t&&t(o)}},e.getUserDetail=function(e){return"object"==typeof alUserService.MCK_USER_DETAIL_MAP[e]?alUserService.MCK_USER_DETAIL_MAP[e]:void 0},e.checkUserConnectedStatus=function(e){var t=new Array,n=new Array;$applozic(".mck-user-ol-status").each(function(){var e=$applozic(this).data("mck-id");if(void 0!==e&&""!==e){t.push(e);var n=mckContactUtils.formatContactId(""+e);$applozic(this).addClass(n),$applozic(this).next().addClass(n)}}),t.length>0&&($applozic.each(t,function(e,t){void 0===alUserService.MCK_USER_DETAIL_MAP[t]&&n.push(t)}),"function"==typeof e&&e(n))},e.loadUserProfile=function(t){if(void 0!==t){"string"!=typeof t&&(t=String(t));var n=[],o=""+t.split(",")[0];n.push(o),e.loadUserProfiles(n)}},e.loadUserProfiles=function(e,t){"function"==typeof t&&t(e,[])},e.getUserStatus=function(e,t){var n=new Object;window.Applozic.ALApiService.getUserStatus({success:function(o){o.users.length>0&&([],"function"==typeof t&&t(o)),n.status="success",n.data=o,e.callback&&e.callback(n)},error:function(){n.status="error",e.callback&&e.callback(n)}})},e.blockUser=function(e,t,n){if(e&&void 0!==t){var o="userId="+e+"&block="+t;mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/block",type:"get",data:o,encryptionKey:window.Applozic.ALApiService.getEncryptionKey(),success:function(o){"object"==typeof o&&"success"===o.status&&(alUserService.MCK_BLOCKED_TO_MAP[e]=t,"function"==typeof n&&n(e))},error:function(){}})}}}var alFileService=new AlFileService;function AlFileService(){var e,t,n,o,r=this;r.init=function(e){t=e.fileBaseUrl,btoa(e.userId+":"+e.deviceKey),e.deviceKey},r.get=function(t){t.appId,e=t.customUploadUrl,t.fileupload,n=t.mapStaticAPIkey,t.accessToken,t.appModuleName,o=t.genereateCloudFileUrl},r.deleteFileMeta=function(e){window.Applozic.ALApiService.deleteFileMeta({data:{blobKey:e,url:t+"/rest/ws/aws/file/delete?key="+e},success:function(e){console.log(e)},error:function(){}})},r.getFilePreviewPath=function(e){return"object"==typeof e?'<a href="'+t+"/rest/ws/aws/file/"+e.blobKey+'" target="_blank">'+e.name+"</a>":""},r.getFilePreviewSize=function(e){return e?e>1048576?"("+parseInt(e/1048576)+" MB)":e>1024?"("+parseInt(e/1024)+" KB)":"("+parseInt(e)+" B)":""},r.getFileurl=function(n){var o;return"object"==typeof n.fileMeta?n.fileMeta.hasOwnProperty("url")?-1!==n.fileMeta.url.indexOf("www.googleapis.com")?(r.generateCloudUrl(n.fileMeta.blobKey,function(e){o=e}),o):""+n.fileMeta.url:n.fileMeta.thumbnailUrl==="thumbnail_"+n.fileMeta.name?e+"/files/"+n.fileMeta.name:t+"/rest/ws/aws/file/"+n.fileMeta.blobKey:""},r.generateCloudUrl=function(e,t){var n=o.replace("{key}",e),r=window.Applozic.ALApiService.getAttachmentHeaders();mckUtils.ajax({type:"get",async:!1,skipEncryption:!0,headers:r,url:n,success:function(e){"function"==typeof t&&t(e)},error:function(e){console.log("error while getting token"+e)}})},r.getFilePath=function(t){if(2===t.contentType)try{var o=$applozic.parseJSON(t.message);if(o.lat&&o.lon)return'<a href="http://maps.google.com/maps?z=17&t=m&q=loc:'+o.lat+","+o.lon+'" target="_blank"><img src="https://maps.googleapis.com/maps/api/staticmap?zoom=17&size=200x150&center='+o.lat+","+o.lon+"&maptype=roadmap&markers=color:red|"+o.lat+","+o.lon+"&key="+n+'"/></a>'}catch(e){if(-1!==t.message.indexOf(","))return'<a href="http://maps.google.com/maps?z=17&t=m&q=loc:'+t.message+'" target="_blank"><img src="https://maps.googleapis.com/maps/api/staticmap?zoom=17&size=200x150&center='+t.message+"&maptype=roadmap&markers=color:red|"+t.message+"&key="+n+'" /></a>'}var s,i;return"object"==typeof t.fileMeta?-1!==t.fileMeta.contentType.indexOf("image")?-1!==t.fileMeta.contentType.indexOf("svg")?'<a href="#" role="link" target="_self" class="file-preview-link fancybox-media imageview" data-type="'+t.fileMeta.contentType+'" data-url="'+r.getFileurl(t)+'" data-name="'+t.fileMeta.name+'"><img src="'+r.getFileurl(t)+'" area-hidden="true"></img></a>':5===t.contentType?'<a href="#" role="link" target="_self" class="file-preview-link fancybox-media imageview" data-type="'+t.fileMeta.contentType+'" data-url="'+t.fileMeta.blobKey+'" data-name="'+t.fileMeta.name+'"><img src="'+t.fileMeta.blobKey+'" area-hidden="true"></img></a>':t.fileMeta.hasOwnProperty("url")?-1!==t.fileMeta.url.indexOf("www.googleapis.com")?(r.generateCloudUrl(t.fileMeta.thumbnailBlobKey,function(e){s=e}),'<a href="#" role="link" target="_self" class="file-preview-link fancybox-media imageview" data-type="'+t.fileMeta.contentType+'" data-url="" data-blobKey="'+t.fileMeta.blobKey+'" data-name="'+t.fileMeta.name+'"><img src="'+s+'" area-hidden="true"></img></a>'):'<a href="#" role="link" target="_self" class="file-preview-link fancybox-media imageview" data-type="'+t.fileMeta.contentType+'" data-url="'+r.getFileurl(t)+'" data-name="'+t.fileMeta.name+'"><img src="'+t.fileMeta.thumbnailUrl+'" area-hidden="true"></img></a>':t.fileMeta.thumbnailUrl==="thumbnail_"+t.fileMeta.name?'<a href="#" role="link" target="_self" class="file-preview-link fancybox-media imageview" data-type="'+t.fileMeta.contentType+'" data-url="'+r.getFileurl(t)+'" data-name="'+t.fileMeta.name+'"><img src="'+e+"/files/thumbnail_"+t.fileMeta.name+'" area-hidden="true"></img></a>':'<a href="#" role="link" target="_self" class="file-preview-link fancybox-media imageview" data-type="'+t.fileMeta.contentType+'" data-url="'+r.getFileurl(t)+'" data-name="'+t.fileMeta.name+'"><img src="'+t.fileMeta.thumbnailUrl+'" area-hidden="true"></img></a>':-1!==t.fileMeta.contentType.indexOf("video")?t.fileMeta.hasOwnProperty("url")&&-1!==t.fileMeta.url.indexOf("www.googleapis.com")?(r.generateCloudUrl(t.fileMeta.blobKey,function(e){i=e}),'<a href="#" target="_self"><video controls class="mck-video-player" onplay="alFileService.updateAudVidUrl(this);" data-cloud-service="google_cloud" data-blobKey="'+t.fileMeta.blobKey+'"><source src="'+i+'" type="video/mp4"><source src="'+i+'" type="video/ogg"></video>'):'<a href= "#" target="_self"><video controls class="mck-video-player"><source src="'+r.getFileurl(t)+'" type="video/mp4"><source src="'+r.getFileurl(t)+'" type="video/ogg"></video></a>':-1!==t.fileMeta.contentType.indexOf("audio")?t.fileMeta.hasOwnProperty("url")&&-1!==t.fileMeta.url.indexOf("www.googleapis.com")?(r.generateCloudUrl(t.fileMeta.blobKey,function(e){i=e}),'<a href="#" target="_self"><audio controls class="mck-audio-player" onplay="alFileService.updateAudVidUrl(this);" data-cloud-service="google_cloud" data-blobKey="'+t.fileMeta.blobKey+'"><source src="'+i+'" type="audio/ogg"><source src="'+i+'" type="audio/mpeg"></audio><p class="mck-file-tag"></p></a>'):'<a href="#" target="_self"><audio controls class="mck-audio-player"><source src="'+r.getFileurl(t)+'" type="audio/ogg"><source src="'+r.getFileurl(t)+'" type="audio/mpeg"></audio><p class="mck-file-tag"></p></a>':'<a href="#" role="link" class="file-preview-link" target="_self"></a>':""},r.updateAudVidUrl=function(e){var t=e.dataset.blobkey,n=(new Date).getTime(),o=e.currentSrc;n>=1e3*r.fetchQueryString("Expires",o)&&(r.generateCloudUrl(t,function(e){getUrl=e}),e.src=getUrl)},this.fetchQueryString=function(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null==n&&console.log("The parameter is null for the searchedquery"),n[1]},r.getFileAttachment=function(e){if("object"==typeof e.fileMeta)return(-1!==e.fileMeta.contentType.indexOf("image")||-1!==e.fileMeta.contentType.indexOf("audio")||-1!==e.fileMeta.contentType.indexOf("video"))&&e.fileMeta.hasOwnProperty("url")&&-1!==e.fileMeta.url.indexOf("www.googleapis.com")?'<a href="javascript:void(0);" role="link" target="_self"  class="file-preview-link" data-blobKey="'+e.fileMeta.blobKey+'" data-cloud-service="google_cloud"><span class="file-detail mck-image-download"><span class="mck-file-name"><span class="mck-attachement-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><g data-name="Group 122"><path fill="none" d="M0 0h24v24H0z" data-name="Rectangle 1"/><path d="M19.00483767 16.29529691l-11.90272845-.0417193a4.358 4.358 0 0 1-4.32607928-4.32607929A4.259 4.259 0 0 1 7.0483691 7.65515915l10.48639356.03394113v.70710678L7.07241074 8.3382243a3.61826547 3.61826547 0 1 0 .00141421 7.2365308l11.89990002.03889087a2.647 2.647 0 0 0 2.68700577-2.68700576 2.688 2.688 0 0 0-2.70680476-2.70680476l-10.15476048-.0615183a1.774 1.774 0 0 0-1.75998878 1.75998879 1.8 1.8 0 0 0 1.76776695 1.76776695l8.82681395.02899138v.70710678l-8.81832866-.02333453a2.491 2.491 0 0 1-2.47840927-2.47840926 2.46 2.46 0 0 1 2.46426713-2.46426714l10.18375186.0311127a3.462 3.462 0 0 1 3.4400745 3.4400745 3.424 3.424 0 0 1-3.4202755 3.3679496z" data-name="Path 1"/></g></svg></span>&nbsp;'+e.fileMeta.name+'</span>&nbsp;<span class="file-size">'+alFileService.getFilePreviewSize(e.fileMeta.size)+"</span></span></a>":'<a href="'+r.getFileurl(e)+'" role="link" target="_self"  class="file-preview-link"><span class="file-detail mck-image-download"><span class="mck-file-name"><span class="mck-attachement-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><g data-name="Group 122"><path fill="none" d="M0 0h24v24H0z" data-name="Rectangle 1"/><path d="M19.00483767 16.29529691l-11.90272845-.0417193a4.358 4.358 0 0 1-4.32607928-4.32607929A4.259 4.259 0 0 1 7.0483691 7.65515915l10.48639356.03394113v.70710678L7.07241074 8.3382243a3.61826547 3.61826547 0 1 0 .00141421 7.2365308l11.89990002.03889087a2.647 2.647 0 0 0 2.68700577-2.68700576 2.688 2.688 0 0 0-2.70680476-2.70680476l-10.15476048-.0615183a1.774 1.774 0 0 0-1.75998878 1.75998879 1.8 1.8 0 0 0 1.76776695 1.76776695l8.82681395.02899138v.70710678l-8.81832866-.02333453a2.491 2.491 0 0 1-2.47840927-2.47840926 2.46 2.46 0 0 1 2.46426713-2.46426714l10.18375186.0311127a3.462 3.462 0 0 1 3.4400745 3.4400745 3.424 3.424 0 0 1-3.4202755 3.3679496z" data-name="Path 1"/></g></svg></span>&nbsp;'+e.fileMeta.name+'</span>&nbsp;<span class="file-size">'+alFileService.getFilePreviewSize(e.fileMeta.size)+"</span></span></a>"},r.getFileIcon=function(e){return e.fileMetaKey&&"object"==typeof e.fileMeta?-1!==e.fileMeta.contentType.indexOf("image")?'<span class="mck-icon--camera"><svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3.2" fill="rgba(38,50,56,.52)"/><path d="M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z" fill="rgba(38,50,56,.52)"/><path d="M0 0h24v24H0z" fill="none"/></svg></span>&nbsp;<span>Image</span>':-1!==e.fileMeta.contentType.indexOf("audio")?'<span class="mck-attachement-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><g data-name="Group 122"><path fill="none" d="M0 0h24v24H0z" data-name="Rectangle 1"/><path d="M19.00483767 16.29529691l-11.90272845-.0417193a4.358 4.358 0 0 1-4.32607928-4.32607929A4.259 4.259 0 0 1 7.0483691 7.65515915l10.48639356.03394113v.70710678L7.07241074 8.3382243a3.61826547 3.61826547 0 1 0 .00141421 7.2365308l11.89990002.03889087a2.647 2.647 0 0 0 2.68700577-2.68700576 2.688 2.688 0 0 0-2.70680476-2.70680476l-10.15476048-.0615183a1.774 1.774 0 0 0-1.75998878 1.75998879 1.8 1.8 0 0 0 1.76776695 1.76776695l8.82681395.02899138v.70710678l-8.81832866-.02333453a2.491 2.491 0 0 1-2.47840927-2.47840926 2.46 2.46 0 0 1 2.46426713-2.46426714l10.18375186.0311127a3.462 3.462 0 0 1 3.4400745 3.4400745 3.424 3.424 0 0 1-3.4202755 3.3679496z" data-name="Path 1"/></g></svg></span>&nbsp;<span>Audio</span>':-1!==e.fileMeta.contentType.indexOf("video")?'<span class="mck-icon--video"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22"><path fill="rgba(38,50,56,.52)" d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l2.29 2.29c.63.63 1.71.18 1.71-.71V8.91c0-.89-1.08-1.34-1.71-.71L17 10.5z"/></svg></span>&nbsp;<span class="mck-icon-video-text">Video</span>':'<span class="mck-attachement-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><g data-name="Group 122"><path fill="none" d="M0 0h24v24H0z" data-name="Rectangle 1"/><path d="M19.00483767 16.29529691l-11.90272845-.0417193a4.358 4.358 0 0 1-4.32607928-4.32607929A4.259 4.259 0 0 1 7.0483691 7.65515915l10.48639356.03394113v.70710678L7.07241074 8.3382243a3.61826547 3.61826547 0 1 0 .00141421 7.2365308l11.89990002.03889087a2.647 2.647 0 0 0 2.68700577-2.68700576 2.688 2.688 0 0 0-2.70680476-2.70680476l-10.15476048-.0615183a1.774 1.774 0 0 0-1.75998878 1.75998879 1.8 1.8 0 0 0 1.76776695 1.76776695l8.82681395.02899138v.70710678l-8.81832866-.02333453a2.491 2.491 0 0 1-2.47840927-2.47840926 2.46 2.46 0 0 1 2.46426713-2.46426714l10.18375186.0311127a3.462 3.462 0 0 1 3.4400745 3.4400745 3.424 3.424 0 0 1-3.4202755 3.3679496z" data-name="Path 1"/></g></svg></span>&nbsp;<span>File</span>':""},r.downloadfile=function(){var e=r.getFileurl(msg),t=document.createElement("a");t.download=thefilename,t.setAttribute("href",e);var n="data:text/csv;charset=utf-8;base64,"+someb64data;t.href=n,document.body.appendChild(t),t.click(),document.body.removeChild(t)}}!function(e){"use strict";"undefined"==typeof AlCustomService?e.Applozic.AlCustomService=function(){var t={logout:function(){void 0!==e.Applozic.ALSocket&&(e.Applozic.ALApiService.AUTH_TOKEN=null,e.Applozic.ALApiService.setAjaxHeaders("","","","",""),e.Applozic.ALApiService.setEncryptionKeys(null,null),e.Applozic.ALSocket.disconnect(),ALStorage.clearSessionStorageElements())}};return t}():console.log("ALCustomService already defined.")}(window);var alMessageService=new AlMessageService;function AlMessageService(){var e,t,n,o=this;o.init=function(o){n=o.fileBaseUrl,e=o.visitor,t=e?"guest":$applozic.trim(o.userId)},o.addMessageToTab=function(e,t,n){var o={to:e.to,groupId:e.groupId,deviceKey:e.deviceKey,contentType:e.contentType,message:e.message,conversationId:e.conversationId,topicId:e.topicId,sendToDevice:!0,createdAtTime:(new Date).getTime(),key:e.key,storeOnDevice:!0,sent:!1,read:!0,metadata:e.metadata?e.metadata:""};o.type=e.type?e.type:5,e.fileMeta&&(o.fileMeta=e.fileMeta),"function"==typeof n&&n(o,t)},o.getMessages=function(e){var t={};e.startTime&&(t.endTime=e.startTime),void 0!==e.userId&&""!==e.userId?(e.isGroup?t.groupId=e.userId:t.userId=e.userId,t.pageSize=30,(IS_MCK_TOPIC_HEADER||IS_MCK_TOPIC_BOX)&&e.conversationId&&(t.conversationId=e.conversationId,void 0===MCK_TAB_CONVERSATION_MAP[e.userId]&&(t.conversationReq=!0))):t.mainPageSize=100,window.Applozic.ALApiService.getMessages({data:t,success:e.callback,error:e.callback})},o.getMessageList=function(e,t){var n=e.id,o={},r={};e.startTime&&(o.endTime=e.startTime),void 0!==e.clientGroupId&&""!==e.clientGroupId?(e.pageSize?o.pageSize=e.pageSize:o.pageSize=50,o.clientGroupId=e.clientGroupId,r={clientGroupId:e.clientGroupId}):void 0!==n&&""!==n?(e.pageSize?o.pageSize=e.pageSize:o.pageSize=50,""+e.isGroup=="true"?o.groupId=n:o.userId=n,r={id:n}):(e.mainPageSize?o.mainPageSize=e.pageSize:o.mainPageSize=50,r={id:""}),e.topicId&&(n||e.clientGroupId)&&(e.conversationId&&(o.conversationId=e.conversationId),e.topicId&&(r.topicId=e.topicId)),window.Applozic.ALApiService.getMessages({data:o,success:function(n){var o=n.data;if(r.status="success",void 0===o.message||0===o.message.length)r.messages=[];else{var s=o.message,i=new Array;$applozic.each(s,function(e,n){"function"==typeof t&&t(n)}),r.messages=i}o.groupFeeds.length>0&&(r.id=o.groupFeeds[0].id),e.callback(o)},error:function(t){r.status="error",e.callback(r)}})},o.getReplyMessageByKey=function(e){return void 0===ALStorage.getMessageByKey(e)&&window.Applozic.ALApiService.updateReplyMessage({data:{key:e},async:!1,success:function(e){ALStorage.updateMckMessageArray(e)}}),ALStorage.getMessageByKey(e)},o.sendDeliveryUpdate=function(e){window.Applozic.ALApiService.sendDeliveryUpdate({data:{key:e.pairedMessageKey},success:function(){},error:function(){}})},o.sendReadUpdate=function(e){void 0!==e&&""!==e&&window.Applozic.ALApiService.sendReadUpdate({data:{key:e},success:function(){},error:function(){}})},o.fetchConversationByTopicId=function(e,t){window.Applozic.ALApiService.fetchConversationByTopicId({data:e,success:function(e){if("object"==typeof e&&"success"===e.status){var n=e.response;if(n.length>0&&$applozic.each(n,function(e,t){if(MCK_CONVERSATION_MAP[t.id]=t,MCK_TOPIC_CONVERSATION_MAP[t.topicId]=[t.id],t.topicDetail)try{MCK_TOPIC_DETAIL_MAP[t.topicId]=$applozic.parseJSON(t.topicDetail)}catch(e){w.console.log("Incorect Topic Detail!")}if(params.tabId&&void 0!==MCK_TAB_CONVERSATION_MAP[params.tabId]){var n=MCK_TAB_CONVERSATION_MAP[params.tabId];n.push(t),MCK_TAB_CONVERSATION_MAP[params.tabId]=n}}),params.isExtMessageList)if(n.length>0)params.conversationId=n[0].id,params.pageSize=50,"function"==typeof t&&t(params);else if("function"==typeof params.callback){var o={};params.tabId?(o.id=params.tabId,o.isGroup=params.isGroup):params.clientGroupId&&(o.clientGroupId=params.clientGroupId),o.topicId=params.topicId,o.status="success",o.messages=[],params.callback(o)}}else if(params.isExtMessageList&&"function"==typeof params.callback){o={};params.tabId?o.id=params.tabId:params.clientGroupId&&(o.clientGroupId=params.clientGroupId),o.topicId=params.topicId,o.status="error",o.errorMessage="Unable to process request. Please try again.",params.callback(o)}},error:function(){if("function"==typeof params.callback){var e={};params.tabId?e.id=params.tabId:params.clientGroupId&&(e.clientGroupId=params.clientGroupId),e.topicId=params.topicId,e.status="error",e.errorMessage="Unable to process request. Please try again.",params.callback(e)}}})},o.getTopicId=function(e,n){if(e.conversationId){var r="id="+e.conversationId;window.Applozic.ALApiService.getTopicId({data:{conversationId:e.conversationId},success:function(s){if("object"==typeof r&&"success"===r.status){var i=r.response;if("object"==typeof i){if(MCK_TOPIC_CONVERSATION_MAP[i.topicId]=[e.conversationId],MCK_CONVERSATION_MAP[e.conversationId]=i,i.topicDetail)try{MCK_TOPIC_DETAIL_MAP[i.topicId]=$applozic.parseJSON(i.topicDetail)}catch(e){w.console.log("Incorect Topic Detail!")}if("function"==typeof MCK_PRICE_DETAIL&&e.priceText&&(MCK_PRICE_DETAIL({custId:t,suppId:e.suppId,productId:i.topicId,price:e.priceText}),o.sendConversationCloseUpdate(e.conversationId)),e.messageType&&"object"==typeof e.message){var a=e.message.groupId?e.message.groupId:e.message.to;if(void 0!==MCK_TAB_CONVERSATION_MAP[a]){var c=MCK_TAB_CONVERSATION_MAP[a];c.push(i),MCK_TAB_CONVERSATION_MAP[a]=c}(void 0===e.populate||e.populate)&&"function"==typeof n&&n(e)}"function"==typeof e.callback&&e.callback(i)}}},error:function(){}})}},o.sendConversationCloseUpdate=function(e){if(e){window.Applozic.ALApiService.sendConversationCloseUpdate({conversationId:e,success:function(e){},error:function(){}})}},o.dispatchMessage=function(e){if("object"===e.messagePxy){var t=e.messagePxy;if(e.topicId){var n=MCK_TOPIC_DETAIL_MAP[e.topicId];if("object"==typeof n&&"undefined"!==n.title)if(t.message||(t.message=$applozic.trim(n.title)),e.conversationId)t.conversationId=e.conversationId;else if(e.topicId){var o={topicId:e.topicId};"object"==typeof n&&(o.topicDetail=w.JSON.stringify(n)),t.conversationPxy=o}if(!t.message&&n.link){var r={blobKey:$applozic.trim(n.link),contentType:"image/png"};t.fileMeta=r,t.contentType=5,FILE_META=[],FILE_META.push(r)}}e.isGroup?t.groupId=e.tabId:t.to=e.tabId,mckMessageService.sendMessage(t)}},o.sendVideoCallMessage=function(e,n,o,r,s,i){var a="CALL_MISSED"==n?"Missed Call":"CALL_REJECTED"==n?"Call Rejected":"";""!=a&&null!=a||(a="video message");var c={to:s,type:5,contentType:o,message:a,metadata:{MSG_TYPE:n,CALL_ID:e,CALL_AUDIO_ONLY:r},senderName:t};return i(c),c},o.sendVideoCallEndMessage=function(e,t,n,o,r,s,i){var a="";r&&(a=mckDateUtils.convertMilisIntoTime(r));var c="CALL_MISSED"==t?"Missed Call":"CALL_REJECTED"==t?"Call Rejected":"CALL_END"==t?"Call End \n Duration: "+a:"video message";""!=c&&null!=c||(c="video message");var l={to:s,type:5,contentType:n,message:c,metadata:{MSG_TYPE:t,CALL_ID:e,CALL_AUDIO_ONLY:o,CALL_DURATION:r}};return i(l),l},o.getMessageFeed=function(e){var o={};if(n=window.Applozic.ALApiService.getFileUrl(),o.key=e.key,o.contentType=e.contentType,o.timeStamp=e.createdAtTime,o.message=e.message,o.from=4===e.type?e.to:t,e.groupId?o.to=e.groupId:o.to=5===e.type?e.to:t,o.status="read",o.type=4===e.type?"inbox":"outbox",5===e.type&&(3===e.status?o.status="sent":4===e.status&&(o.status="delivered")),"object"==typeof e.fileMeta){var r=Object.assign({},e.fileMeta);void 0!==r.url&&""!==r.url||(r.url=n+"/rest/ws/aws/file/"+e.fileMeta.blobKey),delete r.blobKey,o.file=r}return o.source=e.source,o.metadata=e.metadata,o}}